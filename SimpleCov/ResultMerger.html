<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module SimpleCov::ResultMerger - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-adapt_pre_simplecov_0_18_result">::adapt_pre_simplecov_0_18_result</a>
    <li ><a href="#method-c-adapt_result">::adapt_result</a>
    <li ><a href="#method-c-create_result">::create_result</a>
    <li ><a href="#method-c-merge_and_store">::merge_and_store</a>
    <li ><a href="#method-c-merge_coverage">::merge_coverage</a>
    <li ><a href="#method-c-merge_results">::merge_results</a>
    <li ><a href="#method-c-merge_valid_results">::merge_valid_results</a>
    <li ><a href="#method-c-merged_result">::merged_result</a>
    <li ><a href="#method-c-parse_file">::parse_file</a>
    <li ><a href="#method-c-parse_json">::parse_json</a>
    <li ><a href="#method-c-pre_simplecov_0_18_result-3F">::pre_simplecov_0_18_result?</a>
    <li ><a href="#method-c-read_file">::read_file</a>
    <li ><a href="#method-c-read_resultset">::read_resultset</a>
    <li ><a href="#method-c-resultset_path">::resultset_path</a>
    <li ><a href="#method-c-resultset_writelock">::resultset_writelock</a>
    <li ><a href="#method-c-store_result">::store_result</a>
    <li ><a href="#method-c-synchronize_resultset">::synchronize_resultset</a>
    <li ><a href="#method-c-time_since_result_creation">::time_since_result_creation</a>
    <li ><a href="#method-c-valid_results">::valid_results</a>
    <li ><a href="#method-c-within_merge_timeout-3F">::within_merge_timeout?</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-SimpleCov::ResultMerger">
  <h1 id="module-SimpleCov::ResultMerger" class="module">
    module SimpleCov::ResultMerger
  </h1>

  <section class="description">
    
<p>Singleton that is responsible for caching, loading and merging SimpleCov::Results into a single result for coverage analysis based upon multiple test suites.</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">





     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-adapt_pre_simplecov_0_18_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">adapt_pre_simplecov_0_18_result</span><span
            class="method-args">(result)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="adapt_pre_simplecov_0_18_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">adapt_pre_simplecov_0_18_result</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">transform_values</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line_coverage_data</span><span class="ruby-operator">|</span>
    {<span class="ruby-string">&quot;lines&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">line_coverage_data</span>}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-adapt_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">adapt_result</span><span
            class="method-args">(result)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>We changed the format of the raw result data in simplecov, as people are likely to have “old” resultsets lying around (but not too old so that they’re still considered we can adapt them). See <a href="https://github.com/simplecov-ruby/simplecov/pull/824#issuecomment-576049747">github.com/simplecov-ruby/simplecov/pull/824#issuecomment-576049747</a></p>

          <div class="method-source-code" id="adapt_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 172</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">adapt_result</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pre_simplecov_0_18_result?</span>(<span class="ruby-identifier">result</span>)
    <span class="ruby-identifier">adapt_pre_simplecov_0_18_result</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-create_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">create_result</span><span
            class="method-args">(command_names, coverage)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="create_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create_result</span>(<span class="ruby-identifier">command_names</span>, <span class="ruby-identifier">coverage</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">coverage</span>

  <span class="ruby-identifier">command_name</span> = <span class="ruby-identifier">command_names</span>.<span class="ruby-identifier">reject</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:empty?</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;, &quot;</span>)
  <span class="ruby-constant">SimpleCov</span><span class="ruby-operator">::</span><span class="ruby-constant">Result</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">coverage</span>, <span class="ruby-value">command_name:</span> <span class="ruby-identifier">command_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-merge_and_store" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">merge_and_store</span><span
            class="method-args">(*file_paths, ignore_timeout: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="merge_and_store-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_and_store</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">file_paths</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">merge_results</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">file_paths</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-identifier">ignore_timeout</span>)
  <span class="ruby-identifier">store_result</span>(<span class="ruby-identifier">result</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-merge_coverage" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">merge_coverage</span><span
            class="method-args">(*results)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="merge_coverage-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_coverage</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">results</span>)
  <span class="ruby-keyword">return</span> [[<span class="ruby-string">&quot;&quot;</span>], <span class="ruby-keyword">nil</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">results</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">results</span>.<span class="ruby-identifier">reduce</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">memo_command</span>, <span class="ruby-identifier">memo_coverage</span>), (<span class="ruby-identifier">command</span>, <span class="ruby-identifier">coverage</span>)<span class="ruby-operator">|</span>
    <span class="ruby-comment"># timestamp is dropped here, which is intentional (we merge it, it gets a new time stamp as of now)</span>
    <span class="ruby-identifier">merged_coverage</span> = <span class="ruby-constant">Combine</span>.<span class="ruby-identifier">combine</span>(<span class="ruby-constant">Combine</span><span class="ruby-operator">::</span><span class="ruby-constant">ResultsCombiner</span>, <span class="ruby-identifier">memo_coverage</span>, <span class="ruby-identifier">coverage</span>)
    <span class="ruby-identifier">merged_command</span> = <span class="ruby-identifier">memo_command</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command</span>

    [<span class="ruby-identifier">merged_command</span>, <span class="ruby-identifier">merged_coverage</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-merge_results" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">merge_results</span><span
            class="method-args">(*file_paths, ignore_timeout: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="merge_results-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_results</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">file_paths</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-comment"># It is intentional here that files are only read in and parsed one at a time.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># In big CI setups you might deal with 100s of CI jobs and each one producing Megabytes</span>
  <span class="ruby-comment"># of data. Reading them all in easily produces Gigabytes of memory consumption which</span>
  <span class="ruby-comment"># we want to avoid.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># For similar reasons a SimpleCov::Result is only created in the end as that&#39;d create</span>
  <span class="ruby-comment"># even more data especially when it also reads in all source files.</span>
  <span class="ruby-identifier">initial_memo</span> = <span class="ruby-identifier">valid_results</span>(<span class="ruby-identifier">file_paths</span>.<span class="ruby-identifier">shift</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-identifier">ignore_timeout</span>)

  <span class="ruby-identifier">command_names</span>, <span class="ruby-identifier">coverage</span> = <span class="ruby-identifier">file_paths</span>.<span class="ruby-identifier">reduce</span>(<span class="ruby-identifier">initial_memo</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">memo</span>, <span class="ruby-identifier">file_path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">merge_coverage</span>(<span class="ruby-identifier">memo</span>, <span class="ruby-identifier">valid_results</span>(<span class="ruby-identifier">file_path</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-identifier">ignore_timeout</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">create_result</span>(<span class="ruby-identifier">command_names</span>, <span class="ruby-identifier">coverage</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-merge_valid_results" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">merge_valid_results</span><span
            class="method-args">(results, ignore_timeout: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="merge_valid_results-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merge_valid_results</span>(<span class="ruby-identifier">results</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">results</span> = <span class="ruby-identifier">results</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_command_name</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span> <span class="ruby-identifier">within_merge_timeout?</span>(<span class="ruby-identifier">data</span>) } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ignore_timeout</span>

  <span class="ruby-identifier">command_plus_coverage</span> = <span class="ruby-identifier">results</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">command_name</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">|</span>
    [[<span class="ruby-identifier">command_name</span>], <span class="ruby-identifier">adapt_result</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;coverage&quot;</span>))]
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># one file itself _might_ include multiple test runs</span>
  <span class="ruby-identifier">merge_coverage</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">command_plus_coverage</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-merged_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">merged_result</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Gets all SimpleCov::Results stored in resultset, merges them and produces a new <a href="Result.html"><code>SimpleCov::Result</code></a> with merged coverage data and the command_name for the result consisting of a join on all source result’s names</p>

          <div class="method-source-code" id="merged_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">merged_result</span>
  <span class="ruby-comment"># conceptually this is just doing `merge_results(resultset_path)`</span>
  <span class="ruby-comment"># it&#39;s more involved to make syre `synchronize_resultset` is only used around reading</span>
  <span class="ruby-identifier">resultset_hash</span> = <span class="ruby-identifier">read_resultset</span>
  <span class="ruby-identifier">command_names</span>, <span class="ruby-identifier">coverage</span> = <span class="ruby-identifier">merge_valid_results</span>(<span class="ruby-identifier">resultset_hash</span>)

  <span class="ruby-identifier">create_result</span>(<span class="ruby-identifier">command_names</span>, <span class="ruby-identifier">coverage</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-parse_file" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parse_file</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="parse_file-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">parse_json</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-parse_json" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parse_json</span><span
            class="method-args">(content)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="parse_json-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_json</span>(<span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">return</span> {} <span class="ruby-keyword">unless</span> <span class="ruby-identifier">content</span>

  <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">content</span>) <span class="ruby-operator">||</span> {}
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
  <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;[SimpleCov]: Warning! Parsing JSON content of resultset file failed&quot;</span>
  {}
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-pre_simplecov_0_18_result-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">pre_simplecov_0_18_result?</span><span
            class="method-args">(result)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>pre 0.18 coverage data pointed from file directly to an array of line coverage</p>

          <div class="method-source-code" id="pre_simplecov_0_18_result-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pre_simplecov_0_18_result?</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-identifier">_key</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">first</span>

  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-read_file" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">read_file</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="read_file-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)

  <span class="ruby-identifier">data</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>

  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-read_resultset" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">read_resultset</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="read_resultset-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_resultset</span>
  <span class="ruby-identifier">resultset_content</span> =
    <span class="ruby-identifier">synchronize_resultset</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">read_file</span>(<span class="ruby-identifier">resultset_path</span>)
    <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">parse_json</span>(<span class="ruby-identifier">resultset_content</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-resultset_path" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">resultset_path</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The path to the .resultset.json cache file</p>

          <div class="method-source-code" id="resultset_path-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">resultset_path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">SimpleCov</span>.<span class="ruby-identifier">coverage_path</span>, <span class="ruby-string">&quot;.resultset.json&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-resultset_writelock" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">resultset_writelock</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="resultset_writelock-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 18</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">resultset_writelock</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">SimpleCov</span>.<span class="ruby-identifier">coverage_path</span>, <span class="ruby-string">&quot;.resultset.json.lock&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-store_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">store_result</span><span
            class="method-args">(result)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Saves the given <a href="Result.html"><code>SimpleCov::Result</code></a> in the resultset cache</p>

          <div class="method-source-code" id="store_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">store_result</span>(<span class="ruby-identifier">result</span>)
  <span class="ruby-identifier">synchronize_resultset</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Ensure we have the latest, in case it was already cached</span>
    <span class="ruby-identifier">new_resultset</span> = <span class="ruby-identifier">read_resultset</span>

    <span class="ruby-comment"># A single result only ever has one command_name, see `SimpleCov::Result#to_hash`</span>
    <span class="ruby-identifier">command_name</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">result</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">new_resultset</span>[<span class="ruby-identifier">command_name</span>] = <span class="ruby-identifier">data</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">resultset_path</span>, <span class="ruby-string">&quot;w+&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f_</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">f_</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-identifier">new_resultset</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-synchronize_resultset" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">synchronize_resultset</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Ensure only one process is reading or writing the resultset at any given time</p>

          <div class="method-source-code" id="synchronize_resultset-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">synchronize_resultset</span>
  <span class="ruby-comment"># make it reentrant</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@resultset_locked</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@resultset_locked</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@resultset_locked</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">resultset_writelock</span>, <span class="ruby-string">&quot;w+&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">f</span>.<span class="ruby-identifier">flock</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">LOCK_EX</span>)
      <span class="ruby-keyword">yield</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-ivar">@resultset_locked</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-time_since_result_creation" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">time_since_result_creation</span><span
            class="method-args">(data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="time_since_result_creation-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">time_since_result_creation</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">data</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;timestamp&quot;</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-valid_results" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">valid_results</span><span
            class="method-args">(file_path, ignore_timeout: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="valid_results-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 46</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">valid_results</span>(<span class="ruby-identifier">file_path</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">results</span> = <span class="ruby-identifier">parse_file</span>(<span class="ruby-identifier">file_path</span>)
  <span class="ruby-identifier">merge_valid_results</span>(<span class="ruby-identifier">results</span>, <span class="ruby-value">ignore_timeout:</span> <span class="ruby-identifier">ignore_timeout</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-within_merge_timeout-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">within_merge_timeout?</span><span
            class="method-args">(data)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="within_merge_timeout-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/simplecov-0.21.2/lib/simplecov/result_merger.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">within_merge_timeout?</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">time_since_result_creation</span>(<span class="ruby-identifier">data</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-constant">SimpleCov</span>.<span class="ruby-identifier">merge_timeout</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

