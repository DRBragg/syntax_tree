<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module RubyParserStuff - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-deprecate">::deprecate</a>
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    <li class="calls-super" ><a href="#method-i-_racc_do_reduce">#_racc_do_reduce</a>
    <li ><a href="#method-i-arg_concat">#arg_concat</a>
    <li ><a href="#method-i-argl">#argl</a>
    <li ><a href="#method-i-args">#args</a>
    <li ><a href="#method-i-array_pat_concat">#array_pat_concat</a>
    <li ><a href="#method-i-array_to_hash">#array_to_hash</a>
    <li ><a href="#method-i-aryset">#aryset</a>
    <li ><a href="#method-i-assignable">#assignable</a>
    <li ><a href="#method-i-backref_assign_error">#backref_assign_error</a>
    <li ><a href="#method-i-block_append">#block_append</a>
    <li ><a href="#method-i-block_dup_check">#block_dup_check</a>
    <li ><a href="#method-i-block_var">#block_var</a>
    <li ><a href="#method-i-call_args">#call_args</a>
    <li ><a href="#method-i-clean_mlhs">#clean_mlhs</a>
    <li ><a href="#method-i-cond">#cond</a>
    <li ><a href="#method-i-debug">#debug</a>
    <li ><a href="#method-i-debug20">#debug20</a>
    <li ><a href="#method-i-dedent">#dedent</a>
    <li ><a href="#method-i-dedent_size">#dedent_size</a>
    <li ><a href="#method-i-dedent_string">#dedent_string</a>
    <li ><a href="#method-i-do_parse">#do_parse</a>
    <li ><a href="#method-i-end_args">#end_args</a>
    <li ><a href="#method-i-endless_method_name">#endless_method_name</a>
    <li ><a href="#method-i-gettable">#gettable</a>
    <li ><a href="#method-i-hack_encoding">#hack_encoding</a>
    <li ><a href="#method-i-handle_encoding">#handle_encoding</a>
    <li ><a href="#method-i-invert_block_call">#invert_block_call</a>
    <li ><a href="#method-i-inverted-3F">#inverted?</a>
    <li ><a href="#method-i-list_append">#list_append</a>
    <li ><a href="#method-i-list_prepend">#list_prepend</a>
    <li ><a href="#method-i-literal_concat">#literal_concat</a>
    <li ><a href="#method-i-local_pop">#local_pop</a>
    <li ><a href="#method-i-logical_op">#logical_op</a>
    <li ><a href="#method-i-new_aref">#new_aref</a>
    <li ><a href="#method-i-new_arg">#new_arg</a>
    <li ><a href="#method-i-new_array_pattern">#new_array_pattern</a>
    <li ><a href="#method-i-new_array_pattern_tail">#new_array_pattern_tail</a>
    <li ><a href="#method-i-new_assign">#new_assign</a>
    <li ><a href="#method-i-new_attrasgn">#new_attrasgn</a>
    <li ><a href="#method-i-new_begin">#new_begin</a>
    <li ><a href="#method-i-new_body">#new_body</a>
    <li ><a href="#method-i-new_brace_body">#new_brace_body</a>
    <li ><a href="#method-i-new_call">#new_call</a>
    <li ><a href="#method-i-new_case">#new_case</a>
    <li ><a href="#method-i-new_class">#new_class</a>
    <li ><a href="#method-i-new_compstmt">#new_compstmt</a>
    <li ><a href="#method-i-new_const_op_asgn">#new_const_op_asgn</a>
    <li ><a href="#method-i-new_defn">#new_defn</a>
    <li ><a href="#method-i-new_defs">#new_defs</a>
    <li ><a href="#method-i-new_do_body">#new_do_body</a>
    <li ><a href="#method-i-new_find_pattern">#new_find_pattern</a>
    <li ><a href="#method-i-new_find_pattern_tail">#new_find_pattern_tail</a>
    <li ><a href="#method-i-new_for">#new_for</a>
    <li ><a href="#method-i-new_hash">#new_hash</a>
    <li ><a href="#method-i-new_hash_pattern">#new_hash_pattern</a>
    <li ><a href="#method-i-new_hash_pattern_tail">#new_hash_pattern_tail</a>
    <li ><a href="#method-i-new_if">#new_if</a>
    <li ><a href="#method-i-new_in">#new_in</a>
    <li ><a href="#method-i-new_iter">#new_iter</a>
    <li ><a href="#method-i-new_masgn">#new_masgn</a>
    <li ><a href="#method-i-new_masgn_arg">#new_masgn_arg</a>
    <li ><a href="#method-i-new_match">#new_match</a>
    <li ><a href="#method-i-new_module">#new_module</a>
    <li ><a href="#method-i-new_op_asgn">#new_op_asgn</a>
    <li ><a href="#method-i-new_op_asgn1">#new_op_asgn1</a>
    <li ><a href="#method-i-new_op_asgn2">#new_op_asgn2</a>
    <li ><a href="#method-i-new_qsym_list">#new_qsym_list</a>
    <li ><a href="#method-i-new_qsym_list_entry">#new_qsym_list_entry</a>
    <li ><a href="#method-i-new_qword_list">#new_qword_list</a>
    <li ><a href="#method-i-new_qword_list_entry">#new_qword_list_entry</a>
    <li ><a href="#method-i-new_regexp">#new_regexp</a>
    <li ><a href="#method-i-new_resbody">#new_resbody</a>
    <li ><a href="#method-i-new_rescue">#new_rescue</a>
    <li ><a href="#method-i-new_sclass">#new_sclass</a>
    <li ><a href="#method-i-new_string">#new_string</a>
    <li ><a href="#method-i-new_super">#new_super</a>
    <li ><a href="#method-i-new_symbol">#new_symbol</a>
    <li ><a href="#method-i-new_symbol_list">#new_symbol_list</a>
    <li ><a href="#method-i-new_symbol_list_entry">#new_symbol_list_entry</a>
    <li ><a href="#method-i-new_undef">#new_undef</a>
    <li ><a href="#method-i-new_until">#new_until</a>
    <li ><a href="#method-i-new_until_or_while">#new_until_or_while</a>
    <li ><a href="#method-i-new_when">#new_when</a>
    <li ><a href="#method-i-new_while">#new_while</a>
    <li ><a href="#method-i-new_word_list">#new_word_list</a>
    <li ><a href="#method-i-new_word_list_entry">#new_word_list_entry</a>
    <li ><a href="#method-i-new_xstring">#new_xstring</a>
    <li ><a href="#method-i-new_yield">#new_yield</a>
    <li ><a href="#method-i-next_token">#next_token</a>
    <li class="calls-super" ><a href="#method-i-on_error">#on_error</a>
    <li ><a href="#method-i-parse">#parse</a>
    <li ><a href="#method-i-pop_pktbl">#pop_pktbl</a>
    <li ><a href="#method-i-pop_pvtbl">#pop_pvtbl</a>
    <li ><a href="#method-i-prev_value_to_lineno">#prev_value_to_lineno</a>
    <li ><a href="#method-i-process">#process</a>
    <li ><a href="#method-i-push_pktbl">#push_pktbl</a>
    <li ><a href="#method-i-push_pvtbl">#push_pvtbl</a>
    <li ><a href="#method-i-remove_begin">#remove_begin</a>
    <li ><a href="#method-i-remove_whitespace_width">#remove_whitespace_width</a>
    <li ><a href="#method-i-reset">#reset</a>
    <li ><a href="#method-i-ret_args">#ret_args</a>
    <li ><a href="#method-i-s">#s</a>
    <li ><a href="#method-i-syntax_error">#syntax_error</a>
    <li ><a href="#method-i-value_expr">#value_expr</a>
    <li ><a href="#method-i-void_stmts">#void_stmts</a>
    <li ><a href="#method-i-warning">#warning</a>
    <li ><a href="#method-i-whitespace_width">#whitespace_width</a>
    <li ><a href="#method-i-yyerror">#yyerror</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-RubyParserStuff">
  <h1 id="module-RubyParserStuff" class="module">
    module RubyParserStuff
  </h1>

  <section class="description">
    
  </section>

  <section id="5Buntitled-5D" class="documentation-section">


    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
        <dt id="ARG_TYPES">ARG_TYPES
        <dd>
        <dt id="ENCODING_ORDER">ENCODING_ORDER
        <dd><p>This is in sorted order of occurrence according to charlock_holmes against 500k files, with UTF_8 forced to the top.</p>

<p>Overwrite this contstant if you need something different.</p>
        <dt id="JUMP_TYPE">JUMP_TYPE
        <dd>
        <dt id="TAB_WIDTH">TAB_WIDTH
        <dd>
        <dt id="VERSION">VERSION
        <dd>
      </dl>
    </section>

    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-canonicalize_conditions" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">canonicalize_conditions</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Canonicalize conditionals. Eg:</p>

<pre class="ruby"><span class="ruby-keyword">not</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">b</span>
</pre>

<p>becomes:</p>

<pre class="ruby"><span class="ruby-identifier">x</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a</span>
</pre>
        </div>
      </div>
      <div id="attribute-i-comments" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">comments</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-env" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">env</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-in_def" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">in_def</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-in_kwarg" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">in_kwarg</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-in_single" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">in_single</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-last_token_type" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">last_token_type</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The last token type returned from <a href="RubyParserStuff.html#method-i-next_token"><code>next_token</code></a></p>
        </div>
      </div>
      <div id="attribute-i-lexer" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lexer</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-deprecate" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">deprecate</span><span
            class="method-args">(old, new)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="deprecate-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">deprecate</span> <span class="ruby-identifier">old</span>, <span class="ruby-identifier">new</span>
  <span class="ruby-identifier">define_method</span> <span class="ruby-identifier">old</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;DEPRECATED: #{old} -&gt; #{new} from #{caller.first}&quot;</span>
    <span class="ruby-identifier">send</span> <span class="ruby-identifier">new</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">super</span>()

  <span class="ruby-identifier">v</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>[<span class="ruby-regexp">/[23]\d/</span>]
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Bad Class name #{self.class}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lexer</span> = <span class="ruby-constant">RubyLexer</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">parser</span> = <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_kwarg</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-ivar">@env</span> = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">Environment</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-ivar">@comments</span> = []

  <span class="ruby-ivar">@canonicalize_conditions</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-_racc_do_reduce" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">_racc_do_reduce</span><span
            class="method-args">(arg, act)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="_racc_do_reduce-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">_racc_do_reduce</span> <span class="ruby-identifier">arg</span>, <span class="ruby-identifier">act</span>
  <span class="ruby-identifier">x</span> = <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@racc_vstack</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">Sexp</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sexp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">check_line_numbers</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">x</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-arg_concat" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">arg_concat</span><span
            class="method-args">(node1, node2)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="arg_concat-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">arg_concat</span> <span class="ruby-identifier">node1</span>, <span class="ruby-identifier">node2</span> <span class="ruby-comment"># TODO: nuke</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;huh&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">node2</span>

  <span class="ruby-identifier">splat</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:splat</span>, <span class="ruby-identifier">node2</span>)
  <span class="ruby-identifier">splat</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">node2</span>.<span class="ruby-identifier">line</span>

  <span class="ruby-identifier">node1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">splat</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-argl" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">argl</span><span
            class="method-args">(x)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="argl-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">argl</span> <span class="ruby-identifier">x</span>
  <span class="ruby-identifier">x</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:arglist</span>, <span class="ruby-identifier">x</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span>
  <span class="ruby-identifier">x</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">args</span><span
            class="method-args">(args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="args-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 148</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">args</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:args</span>)

  <span class="ruby-identifier">ss</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">grep</span> <span class="ruby-constant">Sexp</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Numeric</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Sexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">sexp_type</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:args</span>, <span class="ruby-value">:block</span>, <span class="ruby-value">:array</span>, <span class="ruby-value">:call_args</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># HACK call_args mismatch</span>
        <span class="ruby-identifier">rest</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">sexp_body</span>

        <span class="ruby-identifier">rest</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Numeric</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">x</span>.<span class="ruby-identifier">first</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">x</span>
          <span class="ruby-keyword">end</span>
        }

        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">rest</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:forward_args</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value">:*</span>]  = <span class="ruby-value">:lvar</span> <span class="ruby-comment"># TODO: arg_var(p, idFWD_REST) ?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value">:**</span>] = <span class="ruby-value">:lvar</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value">:&amp;</span>]  = <span class="ruby-value">:lvar</span>

        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:block_arg</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:&quot;&amp;#{arg.last}&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:shadow</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">name</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">last</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-value">:lvar</span>
        <span class="ruby-keyword">if</span> <span class="ruby-constant">Sexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:shadow</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">result</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:masgn</span>, <span class="ruby-value">:block_pass</span>, <span class="ruby-value">:hash</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># HACK: remove. prolly call_args</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unhandled: #{arg.sexp_type} in #{args.inspect}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">name</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;&amp;*&quot;</span>)
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-value">:lvar</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>, <span class="ruby-keyword">false</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_kwarg</span> = <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;,&quot;</span>, <span class="ruby-string">&quot;|&quot;</span>, <span class="ruby-string">&quot;;&quot;</span>, <span class="ruby-string">&quot;(&quot;</span>, <span class="ruby-string">&quot;)&quot;</span>, <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># ignore</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unhandled: #{arg.inspect} in #{args.inspect}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-array_pat_concat" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">array_pat_concat</span><span
            class="method-args">(lhs, rhs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="array_pat_concat-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 743</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">array_pat_concat</span> <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:PATTERN</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:array_pat</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">rhs</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">sexp_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:array_pat</span>, <span class="ruby-value">:array_TAIL</span>, <span class="ruby-value">:PATTERN</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">sexp_body</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rhs</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-array_to_hash" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">array_to_hash</span><span
            class="method-args">(array)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="array_to_hash-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">array_to_hash</span> <span class="ruby-identifier">array</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">array</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:kwsplat</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">array</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:hash</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">array</span>.<span class="ruby-identifier">sexp_body</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">array</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-aryset" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">aryset</span><span
            class="method-args">(receiver, index)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="aryset-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">aryset</span> <span class="ruby-identifier">receiver</span>, <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">index</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>()
  <span class="ruby-identifier">l</span> = <span class="ruby-identifier">receiver</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:attrasgn</span>, <span class="ruby-identifier">receiver</span>, <span class="ruby-value">:&quot;[]=&quot;</span>,
             <span class="ruby-operator">*</span><span class="ruby-identifier">index</span>.<span class="ruby-identifier">sexp_body</span>).<span class="ruby-identifier">compact</span> <span class="ruby-comment"># [].sexp_body =&gt; nil</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">l</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-assignable" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">assignable</span><span
            class="method-args">(lhs, value = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="assignable-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assignable</span>(<span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">value</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">id</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">lhs</span>
  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">id</span>
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^@@/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">asgn</span> = <span class="ruby-identifier">in_def</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">in_single</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
             <span class="ruby-identifier">s</span>((<span class="ruby-identifier">asgn</span> <span class="ruby-operator">?</span> <span class="ruby-value">:cvasgn</span> <span class="ruby-operator">:</span> <span class="ruby-value">:cvdecl</span>), <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^@/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:iasgn</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^\$/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:gasgn</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[A-Z]/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:cdecl</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-keyword">case</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">id</span>]
             <span class="ruby-keyword">when</span> <span class="ruby-value">:lvar</span>, <span class="ruby-value">:dvar</span>, <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span>
               <span class="ruby-identifier">s</span>(<span class="ruby-value">:lasgn</span>, <span class="ruby-identifier">id</span>)
             <span class="ruby-keyword">else</span>
               <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;wtf? unknown type: #{self.env[id]}&quot;</span>
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">id</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">:lvar</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:lasgn</span>

  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-backref_assign_error" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">backref_assign_error</span><span
            class="method-args">(ref)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="backref_assign_error-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">backref_assign_error</span> <span class="ruby-identifier">ref</span>
  <span class="ruby-comment"># TODO: need a test for this... obviously</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:nth_ref</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;write a test 2&quot;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>, <span class="ruby-string">&quot;Can&#39;t set variable %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:back_ref</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;write a test 3&quot;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>, <span class="ruby-string">&quot;Can&#39;t set back reference %p&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown backref type: #{ref.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-block_append" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">block_append</span><span
            class="method-args">(head, tail)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="block_append-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 294</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">block_append</span>(<span class="ruby-identifier">head</span>, <span class="ruby-identifier">tail</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">head</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">tail</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">line</span> = [<span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span>, <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">line</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">min</span>

  <span class="ruby-identifier">head</span> = <span class="ruby-identifier">remove_begin</span>(<span class="ruby-identifier">head</span>)
  <span class="ruby-identifier">head</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:block</span>, <span class="ruby-identifier">head</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">line</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>

  <span class="ruby-comment"># head.line = line</span>
  <span class="ruby-identifier">head</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tail</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-block_dup_check" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">block_dup_check</span><span
            class="method-args">(call_or_args, block)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="block_dup_check-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 307</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">block_dup_check</span> <span class="ruby-identifier">call_or_args</span>, <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">syntax_error</span> <span class="ruby-string">&quot;Both block arg and actual block given.&quot;</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">block</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">call_or_args</span>.<span class="ruby-identifier">block_pass?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-block_var" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">block_var</span><span
            class="method-args">(*args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="block_var-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 312</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">block_var</span> <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">args</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:masgn</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-call_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">call_args</span><span
            class="method-args">(args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="call_args-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call_args</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:call_args</span>)

  <span class="ruby-identifier">a</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">Sexp</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">a</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Numeric</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Sexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">sexp_type</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:array</span>, <span class="ruby-value">:args</span>, <span class="ruby-value">:call_args</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># HACK? remove array at some point</span>
        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">sexp_body</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">id</span>, <span class="ruby-identifier">_line</span> = <span class="ruby-identifier">arg</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">id</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;,&quot;</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-string">&quot;(&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># ignore</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unhandled: #{arg.inspect} in #{args.inspect}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-clean_mlhs" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">clean_mlhs</span><span
            class="method-args">(sexp)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="clean_mlhs-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 356</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clean_mlhs</span> <span class="ruby-identifier">sexp</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:masgn</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">sexp</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">s</span>(<span class="ruby-value">:masgn</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">sexp</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sexp_body</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">sub</span><span class="ruby-operator">|</span> <span class="ruby-identifier">clean_mlhs</span> <span class="ruby-identifier">sub</span> })
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">debug20</span> <span class="ruby-value">5</span>
      <span class="ruby-identifier">sexp</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:gasgn</span>, <span class="ruby-value">:iasgn</span>, <span class="ruby-value">:lasgn</span>, <span class="ruby-value">:cvasgn</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">debug20</span> <span class="ruby-value">7</span>
      <span class="ruby-identifier">sexp</span> <span class="ruby-comment"># optional value</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unsupported type: #{sexp.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-cond" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">cond</span><span
            class="method-args">(node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="cond-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 377</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cond</span> <span class="ruby-identifier">node</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">node</span> = <span class="ruby-identifier">value_expr</span> <span class="ruby-identifier">node</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:lit</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Regexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">s</span>(<span class="ruby-value">:match</span>, <span class="ruby-identifier">node</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">node</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:and</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">node</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:and</span>,  <span class="ruby-identifier">cond</span>(<span class="ruby-identifier">lhs</span>), <span class="ruby-identifier">cond</span>(<span class="ruby-identifier">rhs</span>))
  <span class="ruby-keyword">when</span> <span class="ruby-value">:or</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">node</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:or</span>,  <span class="ruby-identifier">cond</span>(<span class="ruby-identifier">lhs</span>), <span class="ruby-identifier">cond</span>(<span class="ruby-identifier">rhs</span>))
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dot2</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">label</span> = <span class="ruby-node">&quot;flip#{node.hash}&quot;</span>
    <span class="ruby-identifier">env</span>[<span class="ruby-identifier">label</span>] = <span class="ruby-value">:lvar</span>
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">node</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:flip2</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>) <span class="ruby-comment"># TODO: recurse?</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dot3</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">label</span> = <span class="ruby-node">&quot;flip#{node.hash}&quot;</span>
    <span class="ruby-identifier">env</span>[<span class="ruby-identifier">label</span>] = <span class="ruby-value">:lvar</span>
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">node</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:flip3</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">node</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-debug" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">debug</span><span
            class="method-args">(n)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="debug-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1555</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">debug</span> <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;PRY&quot;</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;pry&quot;</span>; <span class="ruby-identifier">binding</span>.<span class="ruby-identifier">pry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>, <span class="ruby-node">&quot;debug #{n}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-debug20" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">debug20</span><span
            class="method-args">(n, v = nil, r = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="debug20-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">debug20</span> <span class="ruby-identifier">n</span>, <span class="ruby-identifier">v</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">r</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;not yet #{n} #{v.inspect} =&gt; #{r.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$good20</span>[<span class="ruby-identifier">n</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-dedent" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dedent</span><span
            class="method-args">(sexp)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="dedent-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dedent</span> <span class="ruby-identifier">sexp</span>
  <span class="ruby-identifier">dedent_count</span> = <span class="ruby-identifier">dedent_size</span> <span class="ruby-identifier">sexp</span>

  <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">obj</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_whitespace_width</span> <span class="ruby-identifier">l</span>, <span class="ruby-identifier">dedent_count</span> }.<span class="ruby-identifier">join</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Sexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">sexp_type</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:evstr</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-identifier">obj</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">_</span>, <span class="ruby-identifier">str</span> = <span class="ruby-identifier">obj</span>
        <span class="ruby-identifier">str</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_one</span> <span class="ruby-keyword">then</span>
                <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">false</span>
                <span class="ruby-identifier">s1</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">lines</span>
                <span class="ruby-identifier">s1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rest</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_whitespace_width</span> <span class="ruby-identifier">l</span>, <span class="ruby-identifier">dedent_count</span> }.<span class="ruby-identifier">join</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">str</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_whitespace_width</span> <span class="ruby-identifier">l</span>, <span class="ruby-identifier">dedent_count</span> }.<span class="ruby-identifier">join</span>
              <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-identifier">str</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">line</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;unprocessed sexp %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">obj</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;unprocessed: %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">obj</span>]
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-dedent_size" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dedent_size</span><span
            class="method-args">(sexp)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="dedent_size-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 444</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dedent_size</span> <span class="ruby-identifier">sexp</span>
  <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">sexp</span>.<span class="ruby-identifier">flat_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">lines</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Sexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">sexp_type</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:evstr</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">_</span>, <span class="ruby-identifier">str</span> = <span class="ruby-identifier">s</span>
        <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">lines</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_one</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">skip_one</span> = <span class="ruby-keyword">false</span>
          <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">shift</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">lines</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;unprocessed sexp %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">s</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;unprocessed: %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">s</span>]
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">whitespace_width</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">chomp</span> }
  }.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">min</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-dedent_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dedent_string</span><span
            class="method-args">(string, width)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="dedent_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 474</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dedent_string</span> <span class="ruby-identifier">string</span>, <span class="ruby-identifier">width</span>
  <span class="ruby-identifier">characters_skipped</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">indentation_skipped</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">string</span>.<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">char</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">indentation_skipped</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">width</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot; &quot;</span>
      <span class="ruby-identifier">characters_skipped</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">indentation_skipped</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;\t&quot;</span>
      <span class="ruby-identifier">proposed</span> = <span class="ruby-constant">TAB_WIDTH</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">indentation_skipped</span> <span class="ruby-operator">/</span> <span class="ruby-constant">TAB_WIDTH</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">proposed</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">width</span>
      <span class="ruby-identifier">characters_skipped</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">indentation_skipped</span> = <span class="ruby-identifier">proposed</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">string</span>[<span class="ruby-identifier">characters_skipped</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-do_parse" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">do_parse</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>for pure ruby systems only</p>

          <div class="method-source-code" id="do_parse-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">do_parse</span>
  <span class="ruby-identifier">_racc_do_parse_rb</span>(<span class="ruby-identifier">_racc_setup</span>, <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-end_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">end_args</span><span
            class="method-args">(args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="end_args-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">end_args</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lex_state</span>     = <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">State</span><span class="ruby-operator">::</span><span class="ruby-constant">Values</span><span class="ruby-operator">::</span><span class="ruby-constant">EXPR_BEG</span>
  <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">args</span> <span class="ruby-identifier">args</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-endless_method_name" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">endless_method_name</span><span
            class="method-args">(defn_or_defs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="endless_method_name-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">endless_method_name</span> <span class="ruby-identifier">defn_or_defs</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">defn_or_defs</span>[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">defn_or_defs</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword">unless</span> <span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">name</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">end_with?</span> <span class="ruby-string">&quot;=&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">yyerror</span> <span class="ruby-string">&quot;setter method cannot be defined in an endless method definition&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO? token_info_drop(p, &quot;def&quot;, loc-&gt;beg_pos);</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-gettable" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">gettable</span><span
            class="method-args">(id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="gettable-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 493</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">gettable</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">id</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^@@/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:cvar</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^@/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:ivar</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^\$/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:gvar</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[A-Z]/</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:const</span>, <span class="ruby-identifier">id</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">type</span> = <span class="ruby-identifier">env</span>[<span class="ruby-identifier">id</span>]
             <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-keyword">then</span>
               <span class="ruby-identifier">s</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">id</span>)
             <span class="ruby-keyword">else</span>
               <span class="ruby-identifier">new_call</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">id</span>)
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;identifier #{id.inspect} is not valid&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">result</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-hack_encoding" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">hack_encoding</span><span
            class="method-args">(str, extra = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="hack_encoding-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 519</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">hack_encoding</span> <span class="ruby-identifier">str</span>, <span class="ruby-identifier">extra</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">encodings</span> = <span class="ruby-constant">ENCODING_ORDER</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">encodings</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">extra</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">extra</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-comment"># terrible, horrible, no good, very bad, last ditch effort.</span>
  <span class="ruby-identifier">encodings</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">enc</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-identifier">enc</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encode!</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-comment"># unknown encoding name</span>
      <span class="ruby-comment"># do nothing</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidByteSequenceError</span>
      <span class="ruby-comment"># do nothing</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UndefinedConversionError</span>
      <span class="ruby-comment"># do nothing</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># no amount of pain is enough for you.</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Bad encoding. Need a magic encoding comment.&quot;</span> <span class="ruby-keyword">unless</span>
    <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;UTF-8&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-handle_encoding" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">handle_encoding</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Returns a UTF-8 encoded string after processing BOMs and magic encoding comments.</p>

<p>Holy crap… ok. Here goes:</p>

<p>Ruby’s file handling and encoding support is insane. We need to be able to lex a file. The lexer file is explicitly UTF-8 to make things cleaner. This allows us to deal with extended chars in class and method names. In order to do this, we need to encode all input source files as UTF-8. First, we look for a UTF-8 BOM by looking at the first line while forcing its encoding to ASCII-8BIT. If we find a BOM, we strip it and set the expected encoding to UTF-8. Then, we search for a magic encoding comment. If found, it overrides the BOM. Finally, we force the encoding of the input string to whatever was found, and then encode that to UTF-8 for compatibility with the lexer.</p>

          <div class="method-source-code" id="handle_encoding-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 563</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">handle_encoding</span> <span class="ruby-identifier">str</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">has_enc</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:encoding</span>
  <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">header</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">each_line</span>.<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>)
  <span class="ruby-identifier">header</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-string">&quot;ASCII-8BIT&quot;</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_enc</span>

  <span class="ruby-identifier">first</span> = <span class="ruby-identifier">header</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">encoding</span>, <span class="ruby-identifier">str</span> = <span class="ruby-string">+&quot;utf-8&quot;</span>, <span class="ruby-identifier">str</span>.<span class="ruby-identifier">b</span>[<span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">first</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\A\xEF\xBB\xBF/</span>

  <span class="ruby-identifier">encoding</span> = <span class="ruby-node">$1</span>.<span class="ruby-identifier">strip</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">header</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>[<span class="ruby-regexp">/^#.*?-\*-.*?coding:\s*([^ ;]+).*?-\*-/</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">||</span>
    <span class="ruby-identifier">s</span>[<span class="ruby-regexp">/^#.*(?:en)?coding(?:\s*[:=])\s*([\w-]+)/</span>, <span class="ruby-value">1</span>]
  }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_enc</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">encoding</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/utf-8-.+$/</span>, <span class="ruby-string">&quot;utf-8&quot;</span>) <span class="ruby-comment"># HACK for stupid emacs formats</span>
      <span class="ruby-identifier">hack_encoding</span> <span class="ruby-identifier">str</span>, <span class="ruby-identifier">encoding</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;Skipping magic encoding comment&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># nothing specified... ugh. try to encode as utf-8</span>
    <span class="ruby-identifier">hack_encoding</span> <span class="ruby-identifier">str</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_enc</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">str</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-invert_block_call" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">invert_block_call</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="invert_block_call-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 594</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">invert_block_call</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">ret</span>, <span class="ruby-identifier">iter</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">type</span>, <span class="ruby-identifier">call</span> = <span class="ruby-identifier">ret</span>

  <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">call</span>

  <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">s</span>(<span class="ruby-identifier">type</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">line</span>

  [<span class="ruby-identifier">iter</span>, <span class="ruby-identifier">ret</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-inverted-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">inverted?</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="inverted-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 605</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inverted?</span> <span class="ruby-identifier">val</span>
  <span class="ruby-constant">JUMP_TYPE</span>[<span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">sexp_type</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-list_append" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_append</span><span
            class="method-args">(list, item)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="list_append-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 609</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_append</span> <span class="ruby-identifier">list</span>, <span class="ruby-identifier">item</span> <span class="ruby-comment"># TODO: nuke me *sigh*</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>, <span class="ruby-identifier">item</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">list</span>
  <span class="ruby-identifier">list</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>, <span class="ruby-identifier">list</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Sexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">list</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span>
  <span class="ruby-identifier">list</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">item</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-list_prepend" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_prepend</span><span
            class="method-args">(item, list)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="list_prepend-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 615</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_prepend</span> <span class="ruby-identifier">item</span>, <span class="ruby-identifier">list</span> <span class="ruby-comment"># TODO: nuke me *sigh*</span>
  <span class="ruby-identifier">list</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>, <span class="ruby-identifier">list</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Sexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">list</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">list</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span>
  <span class="ruby-identifier">list</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">item</span>
  <span class="ruby-identifier">list</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-literal_concat" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">literal_concat</span><span
            class="method-args">(head, tail)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="literal_concat-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 621</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">literal_concat</span> <span class="ruby-identifier">head</span>, <span class="ruby-identifier">tail</span> <span class="ruby-comment"># TODO: ugh. rewrite</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">tail</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">head</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">head</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tail</span>

  <span class="ruby-identifier">htype</span>, <span class="ruby-identifier">ttype</span> = <span class="ruby-identifier">head</span>.<span class="ruby-identifier">sexp_type</span>, <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">sexp_type</span>

  <span class="ruby-identifier">head</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:dstr</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">head</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">htype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:evstr</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">ttype</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">htype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:str</span>
      <span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span> = <span class="ruby-identifier">head</span>.<span class="ruby-identifier">last</span>, <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">b</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">encoding</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">compatible?</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
      <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">b</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">htype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:dstr</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">head</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tail</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dstr</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">htype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">lineno</span> = <span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span>
      <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">head</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>]
      <span class="ruby-identifier">head</span> = <span class="ruby-identifier">tail</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">lineno</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:array</span>
      <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">line</span> <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">line</span>
      <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">delete_at</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-string">&quot;&quot;</span>)

      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">tail</span>.<span class="ruby-identifier">sexp_body</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:evstr</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">htype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">f</span>, <span class="ruby-identifier">l</span> = <span class="ruby-identifier">head</span>.<span class="ruby-identifier">file</span>, <span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span>
      <span class="ruby-identifier">head</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:dstr</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">head</span>.<span class="ruby-identifier">sexp_body</span>)
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">file</span> = <span class="ruby-identifier">f</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">l</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">tail</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">tail</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">last</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:str</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">head</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-comment"># HACK ?</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">head</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tail</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">x</span> = [<span class="ruby-identifier">head</span>, <span class="ruby-identifier">tail</span>]
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown type: #{x.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">head</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-local_pop" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">local_pop</span><span
            class="method-args">(in_def)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="local_pop-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 675</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">local_pop</span> <span class="ruby-identifier">in_def</span>
  <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">cond</span>.<span class="ruby-identifier">pop</span> <span class="ruby-comment"># group = local_pop</span>
  <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">unextend</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_def</span> = <span class="ruby-identifier">in_def</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-logical_op" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">logical_op</span><span
            class="method-args">(type, left, right)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="logical_op-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 682</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">logical_op</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">left</span>, <span class="ruby-identifier">right</span>
  <span class="ruby-identifier">left</span> = <span class="ruby-identifier">value_expr</span> <span class="ruby-identifier">left</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">left</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">left</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">type</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">left</span>.<span class="ruby-identifier">paren</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">node</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">left</span>, <span class="ruby-keyword">nil</span>

    <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_lhs</span>, <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">node</span>
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rhs</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">type</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">paren</span>
      <span class="ruby-identifier">node</span> = <span class="ruby-identifier">rhs</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-identifier">node</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">rhs</span>, <span class="ruby-identifier">right</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">line</span>)

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">left</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">left</span>, <span class="ruby-identifier">right</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">left</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">left</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_aref" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_aref</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_aref-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 705</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_aref</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:arglist</span>)
  <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:arglist</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span> <span class="ruby-comment"># REFACTOR</span>
  <span class="ruby-identifier">new_call</span> <span class="ruby-identifier">val</span>[<span class="ruby-value">0</span>], <span class="ruby-value">:&quot;[]&quot;</span>, <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_arg" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_arg</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_arg-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 711</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_arg</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">arg</span>, = <span class="ruby-identifier">val</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:args</span>, <span class="ruby-identifier">arg</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Sexp</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">arg</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span> <span class="ruby-keyword">then</span>
    (<span class="ruby-identifier">arg</span>, <span class="ruby-identifier">line</span>), = <span class="ruby-identifier">val</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:args</span>, <span class="ruby-identifier">arg</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">debug20</span> <span class="ruby-value">32</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown f_arg type: #{val.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_array_pattern" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_array_pattern</span><span
            class="method-args">(const, pre_arg, arypat, loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_array_pattern-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 730</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_array_pattern</span> <span class="ruby-identifier">const</span>, <span class="ruby-identifier">pre_arg</span>, <span class="ruby-identifier">arypat</span>, <span class="ruby-identifier">loc</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:array_pat</span>, <span class="ruby-identifier">const</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">loc</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pre_arg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pre_arg</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">arypat</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">arypat</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array_TAIL</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">arypat</span>.<span class="ruby-identifier">sexp_body</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;NO?: %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">arypat</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_array_pattern_tail" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_array_pattern_tail</span><span
            class="method-args">(pre_args, has_rest, rest_arg, post_args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_array_pattern_tail-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 759</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_array_pattern_tail</span> <span class="ruby-identifier">pre_args</span>, <span class="ruby-identifier">has_rest</span>, <span class="ruby-identifier">rest_arg</span>, <span class="ruby-identifier">post_args</span>
  <span class="ruby-comment"># TODO: remove has_rest once all tests pass !!!</span>
  <span class="ruby-identifier">rest_arg</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_rest</span> <span class="ruby-keyword">then</span>
               <span class="ruby-value">:&quot;*#{rest_arg}&quot;</span>
             <span class="ruby-keyword">else</span>
               <span class="ruby-keyword">nil</span>
             <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:array_TAIL</span>).<span class="ruby-identifier">line</span> <span class="ruby-value">666</span>

  <span class="ruby-identifier">array_pat_concat</span> <span class="ruby-identifier">result</span>, <span class="ruby-identifier">pre_args</span>

  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rest_arg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">rest_arg</span>

  <span class="ruby-identifier">array_pat_concat</span> <span class="ruby-identifier">result</span>, <span class="ruby-identifier">post_args</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_assign" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_assign</span><span
            class="method-args">(lhs, rhs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_assign-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 778</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_assign</span> <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">lhs</span>

  <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">value_expr</span> <span class="ruby-identifier">rhs</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:lasgn</span>, <span class="ruby-value">:iasgn</span>, <span class="ruby-value">:cdecl</span>, <span class="ruby-value">:cvdecl</span>, <span class="ruby-value">:gasgn</span>, <span class="ruby-value">:cvasgn</span>, <span class="ruby-value">:attrasgn</span>, <span class="ruby-value">:safe_attrasgn</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rhs</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:const</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:cdecl</span>
    <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rhs</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown lhs #{lhs.inspect} w/ #{rhs.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">lhs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_attrasgn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_attrasgn</span><span
            class="method-args">(recv, meth, call_op = :&quot;.&quot;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_attrasgn-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 796</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_attrasgn</span> <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">call_op</span> = <span class="ruby-value">:&quot;.&quot;</span>
  <span class="ruby-identifier">call_op</span> = <span class="ruby-identifier">call_op</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">call_op</span>

  <span class="ruby-identifier">meth</span> = <span class="ruby-value">:&quot;#{meth}=&quot;</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">call_op</span>.<span class="ruby-identifier">to_sym</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:attrasgn</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;&amp;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:safe_attrasgn</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown call operator: `#{type.inspect}`&quot;</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">recv</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_begin" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_begin</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_begin-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 814</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_begin</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">lineno</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">body</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:begin</span>, <span class="ruby-identifier">body</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:nil</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">lineno</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_body" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_body</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_body-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 823</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_body</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">body</span>, <span class="ruby-identifier">resbody</span>, <span class="ruby-identifier">elsebody</span>, <span class="ruby-identifier">ensurebody</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">body</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">resbody</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:rescue</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>

    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">resbody</span>

    <span class="ruby-keyword">while</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">res</span>
      <span class="ruby-identifier">res</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">resbody</span>(<span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">elsebody</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">elsebody</span>

    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = (<span class="ruby-identifier">body</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">resbody</span>).<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">elsebody</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">resbody</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;else without rescue is useless&quot;</span>)
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:begin</span>, <span class="ruby-identifier">result</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">block_append</span>(<span class="ruby-identifier">result</span>, <span class="ruby-identifier">elsebody</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ensurebody</span>
    <span class="ruby-identifier">lineno</span> = (<span class="ruby-identifier">result</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ensurebody</span>).<span class="ruby-identifier">line</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:ensure</span>, <span class="ruby-identifier">result</span>, <span class="ruby-identifier">ensurebody</span>).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_brace_body" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_brace_body</span><span
            class="method-args">(args, body, lineno)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_brace_body-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 858</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_brace_body</span> <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">new_iter</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_call" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_call</span><span
            class="method-args">(recv, meth, args = nil, call_op = :&quot;.&quot;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_call-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 862</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_call</span> <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">args</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">call_op</span> = <span class="ruby-value">:&quot;.&quot;</span>
  <span class="ruby-identifier">call_op</span> = <span class="ruby-identifier">call_op</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">call_op</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">call_op</span>.<span class="ruby-identifier">to_sym</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:call</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;&amp;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:safe_call</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown call operator: `#{type.inspect}`&quot;</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO: need a test with f(&amp;b) to produce block_pass</span>
  <span class="ruby-comment"># TODO: need a test with f(&amp;b) { } to produce warning</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">ARG_TYPES</span>[<span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span>] <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_body</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># line = result.grep(Sexp).map(&amp;:line).compact.min</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">recv</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">recv</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_case" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_case</span><span
            class="method-args">(expr, body, line)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_case-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 896</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_case</span> <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:case</span>, <span class="ruby-identifier">expr</span>)

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">and</span> [<span class="ruby-value">:when</span>, <span class="ruby-value">:in</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span>
    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">body</span>
    <span class="ruby-identifier">body</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">delete_at</span> <span class="ruby-value">3</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>[<span class="ruby-value">2</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">node</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">block</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">block</span>(<span class="ruby-value">:delete</span>)
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">sexp_body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># else</span>
  <span class="ruby-identifier">body</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:block</span>)
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">body</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_class" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_class</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_class-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 917</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_class</span> <span class="ruby-identifier">val</span>
  <span class="ruby-comment"># TODO: get line from class keyword</span>
  <span class="ruby-identifier">line</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">superclass</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">val</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">3</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">5</span>]

  <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Array</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:class</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">superclass</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_body</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">body</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_compstmt" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_compstmt</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_compstmt-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 938</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_compstmt</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">void_stmts</span>(<span class="ruby-identifier">val</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-constant">Sexp</span>)[<span class="ruby-value">0</span>])
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">remove_begin</span>(<span class="ruby-identifier">result</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">result</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_const_op_asgn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_const_op_asgn</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_const_op_asgn-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 944</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_const_op_asgn</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">lhs</span>, (<span class="ruby-identifier">asgn_op</span>, <span class="ruby-identifier">_</span>), <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">asgn_op</span> = <span class="ruby-identifier">asgn_op</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">asgn_op</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;||&quot;</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn_or</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;&amp;&amp;&quot;</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn_and</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">asgn_op</span>, <span class="ruby-identifier">rhs</span>)
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_defn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_defn</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_defn-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 961</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_defn</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, (<span class="ruby-identifier">name</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">in_def</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">body</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:nil</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:defn</span>, <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">args</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_body</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">pop</span>

  [<span class="ruby-identifier">result</span>, <span class="ruby-identifier">in_def</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_defs" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_defs</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_defs-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 981</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_defs</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">recv</span>, (<span class="ruby-identifier">name</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">in_def</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">body</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:nil</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:defs</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">args</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-comment"># TODO: remove_begin</span>
  <span class="ruby-comment"># TODO: reduce_nodes</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_body</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">pop</span>

  [<span class="ruby-identifier">result</span>, <span class="ruby-identifier">in_def</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_do_body" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_do_body</span><span
            class="method-args">(args, body, lineno)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_do_body-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1004</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_do_body</span> <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">new_iter</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">lineno</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_find_pattern" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_find_pattern</span><span
            class="method-args">(const, pat)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_find_pattern-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1008</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_find_pattern</span> <span class="ruby-identifier">const</span>, <span class="ruby-identifier">pat</span>
  <span class="ruby-identifier">pat</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:find_pat</span>
  <span class="ruby-identifier">pat</span>.<span class="ruby-identifier">insert</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">const</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_find_pattern_tail" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_find_pattern_tail</span><span
            class="method-args">(lhs, mid, rhs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_find_pattern_tail-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1013</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_find_pattern_tail</span> <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">mid</span>, <span class="ruby-identifier">rhs</span>
  <span class="ruby-identifier">lhs_id</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">lhs</span>
  <span class="ruby-identifier">rhs_id</span>, <span class="ruby-identifier">_line</span> = <span class="ruby-identifier">rhs</span>

  <span class="ruby-comment"># TODO: fpinfo-&gt;pre_rest_arg = pre_rest_arg ? assignable(p, pre_rest_arg, 0, loc) : NODE_SPECIAL_NO_NAME_REST;</span>

  <span class="ruby-identifier">lhs_id</span> = <span class="ruby-node">&quot;*#{lhs_id}&quot;</span>.<span class="ruby-identifier">to_sym</span>
  <span class="ruby-identifier">rhs_id</span> = <span class="ruby-node">&quot;*#{rhs_id}&quot;</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">mid</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:array_pat</span> <span class="ruby-comment"># HACK?</span>

  <span class="ruby-identifier">s</span>(<span class="ruby-value">:find_pat_TAIL</span>, <span class="ruby-identifier">lhs_id</span>, <span class="ruby-identifier">mid</span>, <span class="ruby-identifier">rhs_id</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_for" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_for</span><span
            class="method-args">(expr, var, body)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_for-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1027</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_for</span> <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">var</span>, <span class="ruby-identifier">body</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:for</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">var</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">var</span>.<span class="ruby-identifier">line</span>)
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_hash" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_hash</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_hash-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1033</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_hash</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">line</span>, <span class="ruby-identifier">assocs</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">s</span>(<span class="ruby-value">:hash</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">line</span>).<span class="ruby-identifier">concat</span> <span class="ruby-identifier">assocs</span>.<span class="ruby-identifier">sexp_body</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_hash_pattern" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_hash_pattern</span><span
            class="method-args">(const, hash_pat, loc)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_hash_pattern-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1039</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_hash_pattern</span> <span class="ruby-identifier">const</span>, <span class="ruby-identifier">hash_pat</span>, <span class="ruby-identifier">loc</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">pat</span>, <span class="ruby-identifier">kw_args</span>, <span class="ruby-identifier">kw_rest_arg</span> = <span class="ruby-identifier">hash_pat</span>

  <span class="ruby-identifier">line</span> = (<span class="ruby-identifier">const</span><span class="ruby-operator">||</span><span class="ruby-identifier">hash_pat</span>).<span class="ruby-identifier">line</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:hash_pat</span>, <span class="ruby-identifier">const</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">pat</span>.<span class="ruby-identifier">sexp_body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pat</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">kw_args</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">kw_args</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">kw_rest_arg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">kw_rest_arg</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_hash_pattern_tail" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_hash_pattern_tail</span><span
            class="method-args">(kw_args, kw_rest_arg, line)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_hash_pattern_tail-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1051</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_hash_pattern_tail</span> <span class="ruby-identifier">kw_args</span>, <span class="ruby-identifier">kw_rest_arg</span>, <span class="ruby-identifier">line</span> <span class="ruby-comment"># TODO: remove line arg</span>
  <span class="ruby-comment"># kw_rest_arg = assignable(kw_rest_arg, nil).line line if kw_rest_arg</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:hash_pat</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">kw_args</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">kw_rest_arg</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">kw_rest_arg</span>.<span class="ruby-identifier">value</span>
    <span class="ruby-comment"># TODO: I _hate_ this:</span>
    <span class="ruby-identifier">assignable</span> [<span class="ruby-identifier">name</span>, <span class="ruby-identifier">kw_rest_arg</span>.<span class="ruby-identifier">line</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:**</span>
    <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">kw_rest_arg</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_if" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_if</span><span
            class="method-args">(c, t, f)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_if-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1079</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_if</span> <span class="ruby-identifier">c</span>, <span class="ruby-identifier">t</span>, <span class="ruby-identifier">f</span>
  <span class="ruby-identifier">l</span> = [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">line</span>, <span class="ruby-identifier">t</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">line</span>, <span class="ruby-identifier">f</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">line</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">min</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-identifier">cond</span> <span class="ruby-identifier">c</span>
  <span class="ruby-identifier">c</span>, <span class="ruby-identifier">t</span>, <span class="ruby-identifier">f</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">last</span>, <span class="ruby-identifier">f</span>, <span class="ruby-identifier">t</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:not</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">canonicalize_conditions</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:if</span>, <span class="ruby-identifier">c</span>, <span class="ruby-identifier">t</span>, <span class="ruby-identifier">f</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">l</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_in" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_in</span><span
            class="method-args">(pat, body, cases, line)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_in-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 892</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_in</span> <span class="ruby-identifier">pat</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">cases</span>, <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:in</span>, <span class="ruby-identifier">pat</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">cases</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_iter" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_iter</span><span
            class="method-args">(call, args, body)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_iter-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1086</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_iter</span> <span class="ruby-identifier">call</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">body</span>
  <span class="ruby-identifier">body</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">args</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:args</span>)
  <span class="ruby-identifier">args</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:args</span>, <span class="ruby-identifier">args</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:iter</span>)
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">call</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args</span>
  <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">call</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">call</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">args</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">call</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">call</span>
    <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:args</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_masgn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_masgn</span><span
            class="method-args">(lhs, rhs, wrap = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_masgn-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1107</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_masgn</span> <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>, <span class="ruby-identifier">wrap</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">ary</span> = <span class="ruby-identifier">lhs</span>

  <span class="ruby-identifier">line</span> = <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">value_expr</span>(<span class="ruby-identifier">rhs</span>)
  <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">ary</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:to_ary</span>, <span class="ruby-identifier">rhs</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>, <span class="ruby-identifier">rhs</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">wrap</span>
  <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">wrap</span>

  <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">delete_at</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rhs</span>

  <span class="ruby-identifier">lhs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_masgn_arg" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_masgn_arg</span><span
            class="method-args">(rhs, wrap = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_masgn_arg-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_masgn_arg</span> <span class="ruby-identifier">rhs</span>, <span class="ruby-identifier">wrap</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">value_expr</span>(<span class="ruby-identifier">rhs</span>)
  <span class="ruby-comment"># HACK: could be array if lhs isn&#39;t right</span>
  <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:to_ary</span>, <span class="ruby-identifier">rhs</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">wrap</span>
  <span class="ruby-identifier">rhs</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_match" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_match</span><span
            class="method-args">(lhs, rhs)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_match-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_match</span> <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lhs</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">sexp_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:dregx</span>, <span class="ruby-value">:dregx_once</span> <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># TODO: no test coverage</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:match2</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-value">:lit</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:match2</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">rhs</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Regexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">rhs</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">sexp_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:dregx</span>, <span class="ruby-value">:dregx_once</span> <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># TODO: no test coverage</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:match3</span>, <span class="ruby-identifier">rhs</span>, <span class="ruby-identifier">lhs</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-value">:lit</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:match3</span>, <span class="ruby-identifier">rhs</span>, <span class="ruby-identifier">lhs</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Regexp</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">rhs</span>.<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">new_call</span>(<span class="ruby-identifier">lhs</span>, <span class="ruby-value">:&quot;=~&quot;</span>, <span class="ruby-identifier">argl</span>(<span class="ruby-identifier">rhs</span>)).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_module" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_module</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_module-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1152</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_module</span> <span class="ruby-identifier">val</span>
  <span class="ruby-comment"># TODO: get line from module keyword</span>
  <span class="ruby-identifier">line</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">val</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">4</span>]

  <span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Array</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:module</span>, <span class="ruby-identifier">path</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># REFACTOR?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_body</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">body</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">comments</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_op_asgn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_op_asgn</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_op_asgn-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1172</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_op_asgn</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">lhs</span>, (<span class="ruby-identifier">op</span>, <span class="ruby-identifier">_line</span>), <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">op</span> = <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_sym</span>

  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">gettable</span>(<span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">last</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">remove_begin</span> <span class="ruby-identifier">rhs</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">op</span> <span class="ruby-comment"># REFACTOR</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;||&quot;</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn_or</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">lhs</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;&amp;&amp;&quot;</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn_and</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">lhs</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">lhs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_call</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">op</span>, <span class="ruby-identifier">argl</span>(<span class="ruby-identifier">arg</span>))
             <span class="ruby-identifier">lhs</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_op_asgn1" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_op_asgn1</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_op_asgn1-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1193</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_op_asgn1</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">_</span>, (<span class="ruby-identifier">op</span>, <span class="ruby-identifier">_</span>), <span class="ruby-identifier">rhs</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:arglist</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn1</span>, <span class="ruby-identifier">lhs</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">rhs</span>)
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> <span class="ruby-identifier">lhs</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_op_asgn2" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_op_asgn2</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_op_asgn2-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_op_asgn2</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">recv</span>, (<span class="ruby-identifier">call_op</span>, <span class="ruby-identifier">_</span>), (<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">_</span>), (<span class="ruby-identifier">op</span>, <span class="ruby-identifier">_</span>), <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">meth</span> = <span class="ruby-value">:&quot;#{meth}=&quot;</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">call_op</span>.<span class="ruby-identifier">to_sym</span>
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:op_asgn2</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">arg</span>)
           <span class="ruby-keyword">when</span> <span class="ruby-value">:&quot;&amp;.&quot;</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-value">:safe_op_asgn2</span>, <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">meth</span>, <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">arg</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown call operator: `#{type.inspect}`&quot;</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">recv</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_qsym_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_qsym_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_qsym_list-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1220</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_qsym_list</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_qsym_list_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_qsym_list_entry</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_qsym_list_entry-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_qsym_list_entry</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, (<span class="ruby-identifier">str</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:lit</span>, <span class="ruby-identifier">str</span>.<span class="ruby-identifier">to_sym</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_qword_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_qword_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_qword_list-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1229</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_qword_list</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_qword_list_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_qword_list_entry</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_qword_list_entry-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1233</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_qword_list_entry</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, (<span class="ruby-identifier">str</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&quot;ASCII-8BIT&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-identifier">str</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_regexp" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_regexp</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_regexp-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1239</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_regexp</span> <span class="ruby-identifier">val</span>
  (<span class="ruby-identifier">_</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">node</span>, (<span class="ruby-identifier">options</span>, <span class="ruby-identifier">_</span>) = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">node</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">o</span>, <span class="ruby-identifier">k</span> = <span class="ruby-value">0</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-comment"># FIX: this has a better home</span>
    <span class="ruby-identifier">v</span> = {
      <span class="ruby-string">&quot;x&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">EXTENDED</span>,
      <span class="ruby-string">&quot;i&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">IGNORECASE</span>,
      <span class="ruby-string">&quot;m&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">MULTILINE</span>,
      <span class="ruby-string">&quot;o&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ONCE</span>,
      <span class="ruby-string">&quot;n&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_NONE</span>,
      <span class="ruby-string">&quot;e&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_EUC</span>,
      <span class="ruby-string">&quot;s&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_SJIS</span>,
      <span class="ruby-string">&quot;u&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_UTF8</span>,
    }[<span class="ruby-identifier">c</span>]
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;unknown regexp option: #{c}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>
    <span class="ruby-identifier">o</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:lit</span>
    <span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword">then</span>
                <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">o</span>, <span class="ruby-identifier">k</span>)
              <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">begin</span>
                  <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">o</span>)
                <span class="ruby-keyword">rescue</span> <span class="ruby-constant">RegexpError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
                  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;WARNING: #{e.message} for #{node[1].inspect} #{options.inspect}&quot;</span>
                  <span class="ruby-keyword">begin</span>
                    <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;WARNING: trying to recover with ENC_UTF8&quot;</span>
                    <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_UTF8</span>)
                  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">RegexpError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
                    <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;WARNING: trying to recover with ENC_NONE&quot;</span>
                    <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>], <span class="ruby-constant">Regexp</span><span class="ruby-operator">::</span><span class="ruby-constant">ENC_NONE</span>)
                  <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dstr</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/o/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:dregx_once</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:dregx</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">node</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">o</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">o</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">node</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:dregx</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">node</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:dregx_once</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/o/</span>
    <span class="ruby-identifier">node</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">o</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">o</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_resbody" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_resbody</span><span
            class="method-args">(cond, body)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_resbody-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1295</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_resbody</span> <span class="ruby-identifier">cond</span>, <span class="ruby-identifier">body</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">body</span>.<span class="ruby-identifier">shift</span> <span class="ruby-comment"># remove block and splat it in directly</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">body</span> = [<span class="ruby-identifier">body</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">s</span>(<span class="ruby-value">:resbody</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">body</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_rescue" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_rescue</span><span
            class="method-args">(body, resbody)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_rescue-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1305</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_rescue</span> <span class="ruby-identifier">body</span>, <span class="ruby-identifier">resbody</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:rescue</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">resbody</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_sclass" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_sclass</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_sclass-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_sclass</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">recv</span>, <span class="ruby-identifier">in_def</span>, <span class="ruby-identifier">in_single</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">val</span>[<span class="ruby-value">3</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">4</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">6</span>], <span class="ruby-identifier">val</span>[<span class="ruby-value">7</span>]

  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:sclass</span>, <span class="ruby-identifier">recv</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">body</span>.<span class="ruby-identifier">sexp_body</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">body</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">val</span>[<span class="ruby-value">2</span>]
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_def</span> = <span class="ruby-identifier">in_def</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_single</span> = <span class="ruby-identifier">in_single</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_string</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1328</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_string</span> <span class="ruby-identifier">val</span>
  (<span class="ruby-identifier">str</span>, <span class="ruby-identifier">line</span>), = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&quot;UTF-8&quot;</span>)
  <span class="ruby-comment"># TODO: remove:</span>
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&quot;ASCII-8BIT&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-identifier">str</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_super" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_super</span><span
            class="method-args">(args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_super-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1337</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_super</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block_pass</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:super</span>, <span class="ruby-identifier">args</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">args</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:arglist</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:super</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_body</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_symbol" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_symbol</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_symbol-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1346</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_symbol</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:lit</span>, <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_symbol_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_symbol_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_symbol_list-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1351</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_symbol_list</span>
  <span class="ruby-comment"># TODO: hunt down and try to remove ALL lexer.lineno usage!</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_symbol_list_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_symbol_list_entry</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_symbol_list_entry-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1356</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_symbol_list_entry</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">sym</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">sym</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:dstr</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:dsym</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:lit</span>, <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_sym</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:dsym</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">sym</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">sym</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">sym</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_undef" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_undef</span><span
            class="method-args">(n, m = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_undef-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1373</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_undef</span> <span class="ruby-identifier">n</span>, <span class="ruby-identifier">m</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">block_append</span>(<span class="ruby-identifier">n</span>, <span class="ruby-identifier">s</span>(<span class="ruby-value">:undef</span>, <span class="ruby-identifier">m</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">m</span>.<span class="ruby-identifier">line</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">s</span>(<span class="ruby-value">:undef</span>, <span class="ruby-identifier">n</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_until" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_until</span><span
            class="method-args">(block, expr, pre)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_until-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_until</span> <span class="ruby-identifier">block</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">pre</span>
  <span class="ruby-identifier">new_until_or_while</span> <span class="ruby-value">:until</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">pre</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_until_or_while" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_until_or_while</span><span
            class="method-args">(type, block, expr, pre)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_until_or_while-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1385</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_until_or_while</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">pre</span>
  <span class="ruby-identifier">other</span> = <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:until</span> <span class="ruby-operator">?</span> <span class="ruby-value">:while</span> <span class="ruby-operator">:</span> <span class="ruby-value">:until</span>
  <span class="ruby-identifier">line</span> = [<span class="ruby-identifier">block</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">line</span>, <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">line</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">min</span>
  <span class="ruby-identifier">block</span>, <span class="ruby-identifier">pre</span> = <span class="ruby-identifier">block</span>.<span class="ruby-identifier">last</span>, <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:begin</span>

  <span class="ruby-identifier">expr</span> = <span class="ruby-identifier">cond</span> <span class="ruby-identifier">expr</span>

  <span class="ruby-identifier">result</span> = <span class="ruby-keyword">unless</span> <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:not</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">canonicalize_conditions</span> <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-identifier">type</span>,  <span class="ruby-identifier">expr</span>,      <span class="ruby-identifier">block</span>, <span class="ruby-identifier">pre</span>)
           <span class="ruby-keyword">else</span>
             <span class="ruby-identifier">s</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">last</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">pre</span>)
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">line</span> = <span class="ruby-identifier">line</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_when" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_when</span><span
            class="method-args">(cond, body)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_when-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_when</span> <span class="ruby-identifier">cond</span>, <span class="ruby-identifier">body</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:when</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_while" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_while</span><span
            class="method-args">(block, expr, pre)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_while-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1406</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_while</span> <span class="ruby-identifier">block</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">pre</span>
  <span class="ruby-identifier">new_until_or_while</span> <span class="ruby-value">:while</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">pre</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_word_list" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_word_list</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_word_list-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1410</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_word_list</span>
  <span class="ruby-identifier">s</span>(<span class="ruby-value">:array</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_word_list_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_word_list_entry</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_word_list_entry-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_word_list_entry</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">word</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">word</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:evstr</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:dstr</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">word</span>).<span class="ruby-identifier">line</span>(<span class="ruby-identifier">word</span>.<span class="ruby-identifier">line</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">word</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_xstring" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_xstring</span><span
            class="method-args">(val)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_xstring-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1419</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_xstring</span> <span class="ruby-identifier">val</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">node</span> = <span class="ruby-identifier">val</span>

  <span class="ruby-identifier">node</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:str</span>, <span class="ruby-string">&quot;&quot;</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:str</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:xstr</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:dstr</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:dxstr</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">node</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:dxstr</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-identifier">node</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">line</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-new_yield" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new_yield</span><span
            class="method-args">(args = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new_yield-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1438</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">new_yield</span> <span class="ruby-identifier">args</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-comment"># TODO: raise args.inspect unless [:arglist].include? args.first # HACK</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;write a test 4&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block_pass</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>, <span class="ruby-string">&quot;Block argument should not be given.&quot;</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">args</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block_pass</span>

  <span class="ruby-identifier">args</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:arglist</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:arglist</span> <span class="ruby-keyword">if</span> [<span class="ruby-value">:call_args</span>, <span class="ruby-value">:array</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span>
  <span class="ruby-identifier">args</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:arglist</span>, <span class="ruby-identifier">args</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:arglist</span>

  <span class="ruby-identifier">s</span>(<span class="ruby-value">:yield</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>.<span class="ruby-identifier">sexp_body</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-next_token" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">next_token</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="next_token-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1461</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">next_token</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">next_token</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">token</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_token_type</span> = <span class="ruby-identifier">token</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">token</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">token</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">next_token</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-keyword">false</span>, <span class="ruby-keyword">false</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-on_error" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">on_error</span><span
            class="method-args">(et, ev, values)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>

          <div class="method-source-code" id="on_error-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1474</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">on_error</span>(<span class="ruby-identifier">et</span>, <span class="ruby-identifier">ev</span>, <span class="ruby-identifier">values</span>)
  <span class="ruby-identifier">ev</span> = <span class="ruby-identifier">ev</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ev</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ev</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ev</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Racc</span><span class="ruby-operator">::</span><span class="ruby-constant">ParseError</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-comment"># I don&#39;t like how the exception obscures the error message</span>
  <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">replace</span> <span class="ruby-string">&quot;%s:%p :: %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">file</span>, <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>.<span class="ruby-identifier">strip</span>]
  <span class="ruby-identifier">warn</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$DEBUG</span>
  <span class="ruby-identifier">raise</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-parse" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">parse</span><span
            class="method-args">(str, file = &quot;(string)&quot;, time = 10)</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="RubyParserStuff.html#method-i-process">process</a>
        </div>
      </div>

      <div id="method-i-pop_pktbl" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">pop_pktbl</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="pop_pktbl-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1070</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pop_pktbl</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-pop_pvtbl" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">pop_pvtbl</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="pop_pvtbl-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1076</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">pop_pvtbl</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-prev_value_to_lineno" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">prev_value_to_lineno</span><span
            class="method-args">(v)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="prev_value_to_lineno-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1452</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prev_value_to_lineno</span> <span class="ruby-identifier">v</span>
  <span class="ruby-identifier">s</span>, <span class="ruby-identifier">n</span> = <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">s</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process</span><span
            class="method-args">(str, file = &quot;(string)&quot;, time = 10)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Parse <code>str</code> at path <code>file</code> and return a sexp. Raises Timeout::Error if it runs for more than <code>time</code> seconds.</p>

          <div class="method-source-code" id="process-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1488</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">file</span> = <span class="ruby-string">&quot;(string)&quot;</span>, <span class="ruby-identifier">time</span> = <span class="ruby-value">10</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">freeze</span>

  <span class="ruby-constant">Timeout</span>.<span class="ruby-identifier">timeout</span> <span class="ruby-identifier">time</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;bad val: #{str.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">str</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">string</span> = <span class="ruby-identifier">handle_encoding</span> <span class="ruby-identifier">str</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">dup</span>

    <span class="ruby-ivar">@yydebug</span> = <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-string">&quot;DEBUG&quot;</span>

    <span class="ruby-identifier">do_parse</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="RubyParserStuff.html#method-i-parse">parse</a>
        </div>

      </div>

      <div id="method-i-push_pktbl" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">push_pktbl</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="push_pktbl-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1067</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">push_pktbl</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-push_pvtbl" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">push_pvtbl</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="push_pvtbl-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1073</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">push_pvtbl</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-remove_begin" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">remove_begin</span><span
            class="method-args">(node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="remove_begin-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">remove_begin</span> <span class="ruby-identifier">node</span>
  <span class="ruby-identifier">line</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">line</span>

  <span class="ruby-identifier">node</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">while</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:begin</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>

  <span class="ruby-identifier">node</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span>(<span class="ruby-value">:begin</span>)

  <span class="ruby-identifier">node</span>.<span class="ruby-identifier">line</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="RubyParserStuff.html#method-i-value_expr">value_expr</a>
        </div>

      </div>

      <div id="method-i-remove_whitespace_width" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">remove_whitespace_width</span><span
            class="method-args">(line, remove_width = nil)</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="RubyParserStuff.html#method-i-whitespace_width">whitespace_width</a>
        </div>
      </div>

      <div id="method-i-reset" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">reset</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1520</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset</span>
  <span class="ruby-identifier">lexer</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_def</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">in_single</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_token_type</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ret_args" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ret_args</span><span
            class="method-args">(node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ret_args-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1529</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ret_args</span> <span class="ruby-identifier">node</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;write a test 5&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block_pass</span>

    <span class="ruby-identifier">raise</span> <span class="ruby-constant">SyntaxError</span>, <span class="ruby-string">&quot;block argument should not be given&quot;</span> <span class="ruby-keyword">if</span>
      <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block_pass</span>

    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:array</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:call_args</span>
    <span class="ruby-identifier">node</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:array</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>

    <span class="ruby-comment"># HACK matz wraps ONE of the FOUR splats in a newline to</span>
    <span class="ruby-comment"># distinguish. I use paren for now. ugh</span>
    <span class="ruby-identifier">node</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:svalue</span>, <span class="ruby-identifier">node</span>).<span class="ruby-identifier">line</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:splat</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">paren</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> = <span class="ruby-value">:svalue</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:arglist</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">node</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:splat</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-s" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">s</span><span
            class="method-args">(*args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="s-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1548</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">s</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">Sexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-comment"># result.line ||= lexer.lineno if lexer.ss unless ENV[&quot;CHECK_LINE_NUMS&quot;] # otherwise...</span>
  <span class="ruby-identifier">result</span>.<span class="ruby-identifier">file</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">file</span>
  <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-syntax_error" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">syntax_error</span><span
            class="method-args">(msg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="syntax_error-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1563</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">syntax_error</span> <span class="ruby-identifier">msg</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>, <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="RubyParserStuff.html#method-i-yyerror">yyerror</a>
        </div>

      </div>

      <div id="method-i-value_expr" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">value_expr</span><span
            class="method-args">(node)</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="RubyParserStuff.html#method-i-remove_begin">remove_begin</a>
        </div>
      </div>

      <div id="method-i-void_stmts" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">void_stmts</span><span
            class="method-args">(node)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="void_stmts-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1569</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">void_stmts</span> <span class="ruby-identifier">node</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">node</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:block</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:sexp_body=</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_body</span> = <span class="ruby-identifier">node</span>.<span class="ruby-identifier">sexp_body</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_begin</span> <span class="ruby-identifier">n</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">node</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] = <span class="ruby-identifier">node</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_begin</span>(<span class="ruby-identifier">n</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">node</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-warning" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">warning</span><span
            class="method-args">(s)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="warning-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1582</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">warning</span> <span class="ruby-identifier">s</span>
  <span class="ruby-comment"># do nothing for now</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-whitespace_width" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">whitespace_width</span><span
            class="method-args">(line, remove_width = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="whitespace_width-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_parser_extras.rb, line 1586</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">whitespace_width</span> <span class="ruby-identifier">line</span>, <span class="ruby-identifier">remove_width</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">col</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">line</span>.<span class="ruby-identifier">chars</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">remove_width</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">col</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">remove_width</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">c</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot; &quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">col</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;\t&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">n</span> = <span class="ruby-constant">TAB_WIDTH</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">col</span> <span class="ruby-operator">/</span> <span class="ruby-constant">TAB_WIDTH</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">remove_width</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">remove_width</span>
      <span class="ruby-identifier">col</span> = <span class="ruby-identifier">n</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">idx</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">remove_width</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">line</span>[<span class="ruby-identifier">idx</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line</span>[<span class="ruby-identifier">idx</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">col</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="RubyParserStuff.html#method-i-remove_whitespace_width">remove_whitespace_width</a>
        </div>

      </div>

      <div id="method-i-yyerror" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">yyerror</span><span
            class="method-args">(msg)</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="RubyParserStuff.html#method-i-syntax_error">syntax_error</a>
        </div>
      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

