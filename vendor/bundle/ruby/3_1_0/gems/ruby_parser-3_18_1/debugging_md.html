<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>debugging - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../../../../";
  var index_rel_prefix = "../../../../../../";
</script>

<script src="../../../../../../js/navigation.js" defer></script>
<script src="../../../../../../js/search.js" defer></script>
<script src="../../../../../../js/search_index.js" defer></script>
<script src="../../../../../../js/searcher.js" defer></script>
<script src="../../../../../../js/darkfish.js" defer></script>

<link href="../../../../../../css/fonts.css" rel="stylesheet">
<link href="../../../../../../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Quick+Notes+to+Help+with+Debugging">Quick Notes to Help with Debugging</a>
    <li><a href="#label-Reducing">Reducing</a>
    <li><a href="#label-Getting+something+to+compare">Getting something to compare</a>
    <li><a href="#label-Comparing+against+ruby+-2F+ripper-3A">Comparing against ruby / ripper:</a>
    <li><a href="#label-Adding+New+Grammar+Productions">Adding New Grammar Productions</a>
    <li><a href="#label-Structural+Comparing">Structural Comparing</a>
    <li><a href="#label-Starting+Test+First">Starting Test First</a>
  </ul>
</div>


  <div id="project-metadata">
    
<div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
    <li><a href="../../../../../../CHANGELOG_md.html">CHANGELOG</a>
    <li><a href="../../../../../../CODE_OF_CONDUCT_md.html">CODE_OF_CONDUCT</a>
    <li><a href="../../../../../../Gemfile.html">Gemfile</a>
    <li><a href="../../../../../../Gemfile_lock.html">Gemfile.lock</a>
    <li><a href="../../../../../../LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../README_md.html">README</a>
    <li><a href="../../../../../../Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../bin/setup.html">setup</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/bin/stackprof-flamegraph_pl.html">stackprof-flamegraph.pl</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/bin/stackprof-gprof2dot_py.html">stackprof-gprof2dot.py</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/extensions/x86_64-linux/3_1_0/stackprof-0_2_19/gem_build_complete.html">gem.build_complete</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/extensions/x86_64-linux/3_1_0/stackprof-0_2_19/gem_make_out.html">gem_make.out</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/extensions/x86_64-linux/3_1_0/stackprof-0_2_19/mkmf_log.html">mkmf.log</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ast-2_4_2/LICENSE_MIT.html">LICENSE.MIT</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ast-2_4_2/README_YARD_md.html">README.YARD</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/benchmark-ips-2_10_0/History_md.html">History</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/benchmark-ips-2_10_0/LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/benchmark-ips-2_10_0/README_md.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/Gemfile.html">Gemfile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/HISTORY_md.html">HISTORY</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/README_md.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/docile-1_4_0/SECURITY_md.html">SECURITY</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/minitest-5_15_0/History_rdoc.html">History</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/minitest-5_15_0/Manifest_txt.html">Manifest</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/minitest-5_15_0/README_rdoc.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/minitest-5_15_0/Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/parser-3_1_1_0/LICENSE_txt.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/History_rdoc.html">History</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/MIT-LICENSE.html">MIT-LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/README_rdoc.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/command_line_usage_rdoc.html">command_line_usage</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/example/Rakefile1.html">Rakefile1</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/example/Rakefile2.html">Rakefile2</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/glossary_rdoc.html">glossary</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/proto_rake_rdoc.html">proto_rake</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/rake_1.html">rake.1</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/rakefile_rdoc.html">rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/rake-13_0_6/doc/rational_rdoc.html">rational</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/History_rdoc.html">History</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/Manifest_txt.html">Manifest</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/README_rdoc.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/debugging_md.html">debugging</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/ruby_parser-3_18_1/gauntlet_md.html">gauntlet</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/sexp_processor-4_16_0/History_rdoc.html">History</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/sexp_processor-4_16_0/Manifest_txt.html">Manifest</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/sexp_processor-4_16_0/README_rdoc.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/sexp_processor-4_16_0/Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/CHANGELOG_md.html">CHANGELOG</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/README_md.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/doc/alternate-formatters_md.html">alternate-formatters</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/doc/commercial-services_md.html">commercial-services</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-0_21_2/doc/editor-integration_md.html">editor-integration</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov-html-0_12_3/LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov_json_formatter-0_1_3/CHANGELOG_md.html">CHANGELOG</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/simplecov_json_formatter-0_1_3/README_md.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/CHANGELOG_md.html">CHANGELOG</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/Gemfile.html">Gemfile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/LICENSE.html">LICENSE</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/README_md.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/Rakefile.html">Rakefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/bin/stackprof-flamegraph_pl.html">stackprof-flamegraph.pl</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/bin/stackprof-gprof2dot_py.html">stackprof-gprof2dot.py</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/ext/stackprof/Makefile.html">Makefile</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/lib/stackprof/flamegraph/flamegraph_js.html">flamegraph.js</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/lib/stackprof/flamegraph/viewer_html.html">viewer.html</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/vendor/FlameGraph/README.html">README</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/vendor/FlameGraph/flamegraph_pl.html">flamegraph.pl</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/vendor/gprof2dot/gprof2dot_py.html">gprof2dot.py</a>
    <li><a href="../../../../../../vendor/bundle/ruby/3_1_0/gems/stackprof-0_2_19/vendor/gprof2dot/hotshotmain_py.html">hotshotmain.py</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/debugging.md">

<h1 id="label-Quick+Notes+to+Help+with+Debugging">Quick Notes to Help with Debugging<span><a href="#label-Quick+Notes+to+Help+with+Debugging">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-Reducing">Reducing<span><a href="#label-Reducing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>One of the most important steps is reducing the code sample to a minimal reproduction. For example, one thing I’m debugging right now was reported as:</p>

<pre class="ruby"><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>, <span class="ruby-identifier">c</span>, <span class="ruby-identifier">d</span>, <span class="ruby-identifier">e</span>, <span class="ruby-identifier">f</span>, <span class="ruby-identifier">g</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">i</span>, <span class="ruby-identifier">j</span> = <span class="ruby-value">1</span>, <span class="ruby-operator">*</span>[<span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>], <span class="ruby-operator">*</span>[<span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>], <span class="ruby-operator">*</span>[<span class="ruby-identifier">p4</span>, <span class="ruby-identifier">p5</span>, <span class="ruby-identifier">p6</span>]
</pre>

<p>This original sample has 10 items on the left-hand-side (LHS) and 1 + 3 groups of 3 (calls) on the RHS + 3 arrays + 3 splats. That’s a lot.</p>

<p>It’s already been reported (perhaps incorrectly) that this has to do with multiple splats on the RHS, so let’s focus on that. At a minimum the code can be reduced to 2 splats on the RHS and some experimentation shows that it needs a non-splat item to fail:</p>

<pre class="ruby"><span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span> = <span class="ruby-value">1</span>, <span class="ruby-operator">*</span>[<span class="ruby-value">2</span>], <span class="ruby-operator">*</span>[<span class="ruby-value">3</span>]
</pre>

<p>and some intuition further removed the arrays:</p>

<pre class="ruby"><span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span> = <span class="ruby-value">1</span>, <span class="ruby-operator">*</span><span class="ruby-value">2</span>, <span class="ruby-operator">*</span><span class="ruby-value">3</span>
</pre>

<p>the difference is huge and will make a ton of difference when debugging.</p>

<h2 id="label-Getting+something+to+compare">Getting something to compare<span><a href="#label-Getting+something+to+compare">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre>% rake debug3 F=file.rb</pre>

<p>TODO</p>

<h2 id="label-Comparing+against+ruby+-2F+ripper-3A">Comparing against ruby / ripper:<span><a href="#label-Comparing+against+ruby+-2F+ripper-3A">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre>% rake cmp3 F=file.rb</pre>

<p>This compiles the parser &amp; lexer and then parses file.rb using both ruby, ripper, and ruby_parser in debug modes. The output is munged to be as uniform as possible and diffable. I’m using emacs’ <code>ediff-files3</code> to compare these files (via <code>rake cmp3</code>) all at once, but regular <code>diff -u tmp/{ruby,rp}</code> will suffice for most tasks.</p>

<p>From there? Good luck. I’m currently trying to backtrack from rule reductions to state change differences. I’d like to figure out a way to go from this sort of diff to a reasonable test that checks state changes but I don’t have that set up at this point.</p>

<h2 id="label-Adding+New+Grammar+Productions">Adding New Grammar Productions<span><a href="#label-Adding+New+Grammar+Productions">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Ruby adds stuff to the parser ALL THE TIME. It’s actually hard to keep up with, but I’ve added some tools and shown what a typical workflow looks like. Let’s say you want to add ruby 2.7’s “beginless range” (eg <code>..42</code>).</p>

<p>Whenever there’s a language feature missing, I start with comparing the parse trees between MRI and RP:</p>

<h3 id="label-Structural+Comparing">Structural Comparing<span><a href="#label-Structural+Comparing">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>There’s a bunch of rake tasks <code>compare27</code>, <code>compare26</code>, etc that try to normalize and diff MRI’s parse.y parse tree (just the structure of the tree in yacc) to ruby_parser’s parse tree (racc). It’s the first thing I do when I’m adding a new version. Stub out all the version differences, and then start to diff the structure and move ruby_parser towards the new changes.</p>

<p>Some differences are just gonna be there… but here’s an example of a real diff between MRI 2.7 and ruby_parser as of today:</p>

<pre>arg tDOT3 arg
     arg tDOT2
     arg tDOT3
-    tBDOT2 arg
-    tBDOT3 arg
     arg tPLUS arg
     arg tMINUS arg
     arg tSTAR2 arg</pre>

<p>This is a new language feature that ruby_parser doesn’t handle yet. It’s in MRI (the left hand side of the diff) but not ruby_parser (the right hand side) so it is a <code>-</code> or missing line.</p>

<p>Some other diffs will have both <code>+</code> and <code>-</code> lines. That usually happens when MRI has been refactoring the grammar. Sometimes I choose to adapt those refactorings and sometimes it starts to get too difficult to maintain multiple versions of ruby parsing in a single file.</p>

<p>But! This structural comparing is always a place you should look when ruby_parser is failing to parse something. Maybe it just hasn’t been implemented yet and the easiest place to look is the diff.</p>

<h3 id="label-Starting+Test+First">Starting Test First<span><a href="#label-Starting+Test+First">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The next thing I do is to add a parser test to cover that feature. I usually start with the parser and work backwards towards the lexer as needed, as I find it structures things properly and keeps things goal oriented.</p>

<p>So, make a new parser test, usually in the versioned section of the parser tests.</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">test_beginless2</span>
    <span class="ruby-identifier">rb</span> = <span class="ruby-string">&quot;..10\n; ..a\n; c&quot;</span>
    <span class="ruby-identifier">pt</span> = <span class="ruby-identifier">s</span>(<span class="ruby-value">:block</span>,
           <span class="ruby-identifier">s</span>(<span class="ruby-value">:dot2</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">s</span>(<span class="ruby-value">:lit</span>, <span class="ruby-value">0</span>).<span class="ruby-identifier">line</span>(<span class="ruby-value">1</span>)).<span class="ruby-identifier">line</span>(<span class="ruby-value">1</span>),
           <span class="ruby-identifier">s</span>(<span class="ruby-value">:dot2</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">s</span>(<span class="ruby-value">:call</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:a</span>).<span class="ruby-identifier">line</span>(<span class="ruby-value">2</span>)).<span class="ruby-identifier">line</span>(<span class="ruby-value">2</span>),
           <span class="ruby-identifier">s</span>(<span class="ruby-value">:call</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:c</span>).<span class="ruby-identifier">line</span>(<span class="ruby-value">3</span>)).<span class="ruby-identifier">line</span>(<span class="ruby-value">1</span>)

    <span class="ruby-identifier">assert_parse_line</span> <span class="ruby-identifier">rb</span>, <span class="ruby-identifier">pt</span>, <span class="ruby-value">1</span>

    <span class="ruby-identifier">flunk</span> <span class="ruby-string">&quot;not done yet&quot;</span>
  <span class="ruby-keyword">end</span>
</pre>

<p>(In this case copied and modified the tests for open ranges from 2.6) and run it to get my first error:</p>

<pre>% rake N=/beginless/

...

E

Finished in 0.021814s, 45.8421 runs/s, 0.0000 assertions/s.

  1) Error:
TestRubyParserV27#test_whatevs:
Racc::ParseError: (string):1 :: parse error on value &quot;..&quot; (tDOT2)
    GEMS/2.7.0/gems/racc-1.5.0/lib/racc/parser.rb:538:in `on_error&#39;
    WORK/ruby_parser/dev/lib/ruby_parser_extras.rb:1304:in `on_error&#39;
    (eval):3:in `_racc_do_parse_c&#39;
    (eval):3:in `do_parse&#39;
    WORK/ruby_parser/dev/lib/ruby_parser_extras.rb:1329:in `block in process&#39;
    RUBY/lib/ruby/2.7.0/timeout.rb:95:in `block in timeout&#39;
    RUBY/lib/ruby/2.7.0/timeout.rb:33:in `block in catch&#39;
    RUBY/lib/ruby/2.7.0/timeout.rb:33:in `catch&#39;
    RUBY/lib/ruby/2.7.0/timeout.rb:33:in `catch&#39;
    RUBY/lib/ruby/2.7.0/timeout.rb:110:in `timeout&#39;
    WORK/ruby_parser/dev/lib/ruby_parser_extras.rb:1317:in `process&#39;
    WORK/ruby_parser/dev/test/test_ruby_parser.rb:4198:in `assert_parse&#39;
    WORK/ruby_parser/dev/test/test_ruby_parser.rb:4221:in `assert_parse_line&#39;
    WORK/ruby_parser/dev/test/test_ruby_parser.rb:4451:in `test_whatevs&#39;</pre>

<p>For starters, we know the missing production is for <code>tBDOT2 arg</code>. It is currently blowing up because it is getting <code>tDOT2</code> and simply doesn’t know what to do with it, so it raises the error. As the diff suggests, that’s the wrong token to begin with, so it is probably time to also create a lexer test:</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">test_yylex_bdot2</span>
  <span class="ruby-identifier">assert_lex3</span>(<span class="ruby-string">&quot;..42&quot;</span>,
              <span class="ruby-identifier">s</span>(<span class="ruby-value">:dot2</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">s</span>(<span class="ruby-value">:lit</span>, <span class="ruby-value">42</span>)),

              <span class="ruby-value">:tBDOT2</span>,   <span class="ruby-string">&quot;..&quot;</span>, <span class="ruby-constant">EXPR_BEG</span>,
              <span class="ruby-value">:tINTEGER</span>, <span class="ruby-string">&quot;42&quot;</span>, <span class="ruby-constant">EXPR_NUM</span>)

  <span class="ruby-identifier">flunk</span> <span class="ruby-string">&quot;not done yet&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This one is mostly speculative at this point. It says “if we’re lexing this string, we should get this sexp if we fully parse it, and the lexical stream should look like this”… That last bit is mostly made up at this point. Sometimes I don’t know exactly what expression state things should be in until I start really digging in.</p>

<p>At this point, I have 2 failing tests that are directing me in the right direction. It’s now a matter of digging through <code>compare/parse26.y</code> to see how the lexer differs and implementing it…</p>

<p>But this is a good start to the doco for now. I’ll add more later.</p>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

