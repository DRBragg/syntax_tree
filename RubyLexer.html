<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class RubyLexer - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link"><a href="Object.html">Object</a>
</div>

    
<div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
    <li><a class="include" href="RubyLexer/State/Values.html">RubyLexer::State::Values</a>
    <li><a class="include" href="RubyLexer/SSWrapper.html">RubyLexer::SSWrapper</a>
  </ul>
</div>

    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-action">#action</a>
    <li ><a href="#method-i-arg_ambiguous">#arg_ambiguous</a>
    <li ><a href="#method-i-arg_state">#arg_state</a>
    <li ><a href="#method-i-column">#column</a>
    <li ><a href="#method-i-comments">#comments</a>
    <li ><a href="#method-i-d">#d</a>
    <li ><a href="#method-i-debug">#debug</a>
    <li ><a href="#method-i-eat_whitespace">#eat_whitespace</a>
    <li ><a href="#method-i-expr_dot-3F">#expr_dot?</a>
    <li ><a href="#method-i-expr_fname-3F">#expr_fname?</a>
    <li ><a href="#method-i-expr_result">#expr_result</a>
    <li ><a href="#method-i-heredoc">#heredoc</a>
    <li ><a href="#method-i-heredoc_identifier">#heredoc_identifier</a>
    <li ><a href="#method-i-heredoc_restore">#heredoc_restore</a>
    <li ><a href="#method-i-ignore_body_comments">#ignore_body_comments</a>
    <li ><a href="#method-i-in_fname-3F">#in_fname?</a>
    <li ><a href="#method-i-int_with_base">#int_with_base</a>
    <li ><a href="#method-i-is_after_operator-3F">#is_after_operator?</a>
    <li ><a href="#method-i-is_arg-3F">#is_arg?</a>
    <li ><a href="#method-i-is_beg-3F">#is_beg?</a>
    <li ><a href="#method-i-is_end-3F">#is_end?</a>
    <li ><a href="#method-i-is_label_possible-3F">#is_label_possible?</a>
    <li ><a href="#method-i-is_label_suffix-3F">#is_label_suffix?</a>
    <li ><a href="#method-i-is_local_id">#is_local_id</a>
    <li ><a href="#method-i-is_space_arg-3F">#is_space_arg?</a>
    <li ><a href="#method-i-lambda_beginning-3F">#lambda_beginning?</a>
    <li ><a href="#method-i-lex_strterm-3D">#lex_strterm=</a>
    <li ><a href="#method-i-lineno-3D">#lineno=</a>
    <li ><a href="#method-i-location">#location</a>
    <li ><a href="#method-i-lvar_defined-3F">#lvar_defined?</a>
    <li ><a href="#method-i-matches">#matches</a>
    <li ><a href="#method-i-newtok">#newtok</a>
    <li ><a href="#method-i-next_token">#next_token</a>
    <li ><a href="#method-i-nextc">#nextc</a>
    <li ><a href="#method-i-not_end-3F">#not_end?</a>
    <li ><a href="#method-i-old_lineno-3D">#old_lineno=</a>
    <li ><a href="#method-i-parse">#parse</a>
    <li ><a href="#method-i-parse_file">#parse_file</a>
    <li ><a href="#method-i-parse_string">#parse_string</a>
    <li ><a href="#method-i-possibly_escape_string">#possibly_escape_string</a>
    <li ><a href="#method-i-process_amper">#process_amper</a>
    <li ><a href="#method-i-process_backref">#process_backref</a>
    <li ><a href="#method-i-process_begin">#process_begin</a>
    <li ><a href="#method-i-process_brace_close">#process_brace_close</a>
    <li ><a href="#method-i-process_brace_open">#process_brace_open</a>
    <li ><a href="#method-i-process_colon1">#process_colon1</a>
    <li ><a href="#method-i-process_colon2">#process_colon2</a>
    <li ><a href="#method-i-process_dots">#process_dots</a>
    <li ><a href="#method-i-process_float">#process_float</a>
    <li ><a href="#method-i-process_gvar">#process_gvar</a>
    <li ><a href="#method-i-process_gvar_oddity">#process_gvar_oddity</a>
    <li ><a href="#method-i-process_ivar">#process_ivar</a>
    <li ><a href="#method-i-process_label">#process_label</a>
    <li ><a href="#method-i-process_label_or_string">#process_label_or_string</a>
    <li ><a href="#method-i-process_lchevron">#process_lchevron</a>
    <li ><a href="#method-i-process_newline_or_comment">#process_newline_or_comment</a>
    <li ><a href="#method-i-process_nthref">#process_nthref</a>
    <li ><a href="#method-i-process_paren">#process_paren</a>
    <li ><a href="#method-i-process_percent">#process_percent</a>
    <li ><a href="#method-i-process_percent_quote">#process_percent_quote</a>
    <li ><a href="#method-i-process_plus_minus">#process_plus_minus</a>
    <li ><a href="#method-i-process_questionmark">#process_questionmark</a>
    <li ><a href="#method-i-process_simple_string">#process_simple_string</a>
    <li ><a href="#method-i-process_slash">#process_slash</a>
    <li ><a href="#method-i-process_square_bracket">#process_square_bracket</a>
    <li ><a href="#method-i-process_string_or_heredoc">#process_string_or_heredoc</a>
    <li ><a href="#method-i-process_symbol">#process_symbol</a>
    <li ><a href="#method-i-process_token">#process_token</a>
    <li ><a href="#method-i-process_token_keyword">#process_token_keyword</a>
    <li ><a href="#method-i-process_underscore">#process_underscore</a>
    <li ><a href="#method-i-rb_compile_error">#rb_compile_error</a>
    <li ><a href="#method-i-read_escape">#read_escape</a>
    <li ><a href="#method-i-regx_options">#regx_options</a>
    <li ><a href="#method-i-reset">#reset</a>
    <li ><a href="#method-i-ruby22_label-3F">#ruby22_label?</a>
    <li ><a href="#method-i-ruby22plus-3F">#ruby22plus?</a>
    <li ><a href="#method-i-ruby23plus-3F">#ruby23plus?</a>
    <li ><a href="#method-i-ruby24minus-3F">#ruby24minus?</a>
    <li ><a href="#method-i-ruby27plus-3F">#ruby27plus?</a>
    <li ><a href="#method-i-scan_variable_name">#scan_variable_name</a>
    <li ><a href="#method-i-scanner_class">#scanner_class</a>
    <li ><a href="#method-i-space_vs_beginning">#space_vs_beginning</a>
    <li ><a href="#method-i-string">#string</a>
    <li ><a href="#method-i-string_term">#string_term</a>
    <li ><a href="#method-i-tokadd">#tokadd</a>
    <li ><a href="#method-i-tokadd_escape">#tokadd_escape</a>
    <li ><a href="#method-i-tokadd_string">#tokadd_string</a>
    <li ><a href="#method-i-tokadd_utf8">#tokadd_utf8</a>
    <li ><a href="#method-i-unescape">#unescape</a>
    <li ><a href="#method-i-warning">#warning</a>
    <li ><a href="#method-i-was_label-3F">#was_label?</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-RubyLexer">
  <h1 id="class-RubyLexer" class="class">
    class RubyLexer
  </h1>

  <section class="description">
    
<p>The generated lexer <a href="RubyLexer.html"><code>RubyLexer</code></a></p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-brace_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">brace_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-cmd_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cmd_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-cmdarg" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cmdarg</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-command_start" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">command_start</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-comments" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">comments</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-cond" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cond</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-filename" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filename</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The file name / path</p>
        </div>
      </div>
      <div id="attribute-i-last_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">last_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-lex_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lex_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-lex_strterm" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lex_strterm</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Additional context surrounding tokens that both the lexer and grammar use.</p>
        </div>
      </div>
      <div id="attribute-i-lineno" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lineno</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The current line number.</p>
        </div>
      </div>
      <div id="attribute-i-lpar_beg" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lpar_beg</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-match" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">match</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The StringScanner for this lexer.</p>
        </div>
      </div>
      <div id="attribute-i-old_lex_strterm-3D" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_lex_strterm=</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Additional context surrounding tokens that both the lexer and grammar use.</p>
        </div>
      </div>
      <div id="attribute-i-old_lineno" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_lineno</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-old_pos" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_pos</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The previous position. Only available if the :column option is on.</p>
        </div>
      </div>
      <div id="attribute-i-old_ss" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_ss</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-paren_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">paren_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-parser" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">parser</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-space_seen" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">space_seen</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-ss" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">ss</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The StringScanner for this lexer.</p>
        </div>
      </div>
      <div id="attribute-i-start_of_current_line_pos" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">start_of_current_line_pos</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The position of the start of the current line. Only available if the :column option is on.</p>
        </div>
      </div>
      <div id="attribute-i-state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>The current lexical state.</p>
        </div>
      </div>
      <div id="attribute-i-string_buffer" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">string_buffer</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-string_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">string_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-token" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">token</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        <p>Last token read via next_token.</p>
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(_ = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span> <span class="ruby-identifier">_</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@lex_state</span> = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># remove one warning under $DEBUG</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_NONE</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cond</span>   = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:cond</span>, <span class="ruby-identifier">$DEBUG</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmdarg</span> = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:cmdarg</span>, <span class="ruby-identifier">$DEBUG</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ss</span>     = <span class="ruby-constant">RPStringScanner</span>.<span class="ruby-identifier">new</span> <span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-action" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">action</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Yields on the current action.</p>

          <div class="method-source-code" id="action-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">action</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-arg_ambiguous" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">arg_ambiguous</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="arg_ambiguous-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 129</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">arg_ambiguous</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">warning</span> <span class="ruby-string">&quot;Ambiguous first argument. make sure.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-arg_state" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">arg_state</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="arg_state-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">arg_state</span>
  <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_ARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_BEG</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-column" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">column</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The current column, starting at 0. Only available if the :column option is on.</p>

          <div class="method-source-code" id="column-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">column</span>
  <span class="ruby-identifier">old_pos</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start_of_current_line_pos</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-comments" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">comments</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="comments-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">comments</span> <span class="ruby-comment"># TODO: remove this... maybe comment_string + attr_accessor</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">join</span>
  <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-d" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">d</span><span
            class="method-args">(o)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="d-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 1111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">d</span> <span class="ruby-identifier">o</span>
  <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-debug" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">debug</span><span
            class="method-args">(n)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="debug-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">debug</span> <span class="ruby-identifier">n</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;debug #{n}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-eat_whitespace" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">eat_whitespace</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="eat_whitespace-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 4</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">eat_whitespace</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s+/</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>

  <span class="ruby-identifier">r</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">eat_whitespace</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">eos?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">in_heredoc?</span> <span class="ruby-comment"># forces heredoc pop</span>

  <span class="ruby-identifier">r</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-expr_dot-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">expr_dot?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="expr_dot-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expr_dot?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_DOT</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-expr_fname-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">expr_fname?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="expr_fname-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 155</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expr_fname?</span> <span class="ruby-comment"># REFACTOR</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-expr_result" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">expr_result</span><span
            class="method-args">(token, text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="expr_result-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">expr_result</span> <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-heredoc" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">heredoc</span><span
            class="method-args">(here)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="heredoc-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 13</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">heredoc</span> <span class="ruby-identifier">here</span>                              <span class="ruby-comment"># ../compare/parse30.y:7678</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">_indent_max</span>, <span class="ruby-identifier">_lineno</span>, <span class="ruby-identifier">range</span> = <span class="ruby-identifier">here</span>

  <span class="ruby-identifier">start_line</span> = <span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">eos</span> = <span class="ruby-identifier">term</span> <span class="ruby-comment"># HACK</span>
  <span class="ruby-identifier">indent</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_INDENT</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> = []

  <span class="ruby-identifier">last_line</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ss_string</span>[<span class="ruby-identifier">range</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">range</span>
  <span class="ruby-identifier">eol</span> = <span class="ruby-identifier">last_line</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">last_line</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;\r\n&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&quot;\r\n&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-comment"># HACK</span>

  <span class="ruby-identifier">expand</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>

  <span class="ruby-comment"># TODO? p-&gt;heredoc_line_indent == -1</span>

  <span class="ruby-identifier">indent_re</span> = <span class="ruby-identifier">indent</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;[ \t]*&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">eos_re</span>    = <span class="ruby-regexp">/#{indent_re}#{Regexp.escape eos}(?=\r?\n|\z)/</span>
  <span class="ruby-identifier">err_msg</span>   = <span class="ruby-node">&quot;can&#39;t match #{eos_re.inspect} anywhere in &quot;</span>

  <span class="ruby-identifier">maybe_pop_stack</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\r?\n|\z/</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">matched</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\n/</span>

    <span class="ruby-identifier">heredoc_restore</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_END</span>

    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_END</span>, [<span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">range</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#(?=\$(-.|[a-zA-Z_0-9~\*\$\?!@\/\\;,\.=:&lt;&gt;\&quot;\&amp;\`\&#39;+]))/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># TODO: !ISASCII</span>
      <span class="ruby-comment"># ?! see parser_peek_variable_name</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#(?=\@\@?[a-zA-Z_])/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># TODO: !ISASCII</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#[{]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DBEG</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;#&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">begin</span>
      <span class="ruby-comment"># NOTE: this visibly diverges from the C code but uses tokadd_string</span>
      <span class="ruby-comment">#       to stay clean.</span>

      <span class="ruby-identifier">str</span> = <span class="ruby-identifier">tokadd_string</span> <span class="ruby-identifier">func</span>, <span class="ruby-identifier">eol</span>, <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">eol</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">str</span> = <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>
        <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">clear</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">str</span>, <span class="ruby-identifier">start_line</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\r?\n/</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># TODO: try to remove most scan(/\n/) and friends</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">until</span> <span class="ruby-identifier">check</span> <span class="ruby-identifier">eos_re</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">until</span> <span class="ruby-identifier">check</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*(\r?\n|\z)/</span>)
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">string_content</span> = <span class="ruby-keyword">begin</span>
                     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>
                     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">b</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>
                     <span class="ruby-identifier">s</span>
                   <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">clear</span>

  <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">string_content</span>, <span class="ruby-identifier">start_line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-heredoc_identifier" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">heredoc_identifier</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="heredoc_identifier-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">heredoc_identifier</span>                        <span class="ruby-comment"># ../compare/parse30.y:7354</span>
  <span class="ruby-identifier">token</span>  = <span class="ruby-value">:tSTRING_BEG</span>
  <span class="ruby-identifier">func</span>   = <span class="ruby-constant">STR_FUNC_BORING</span>
  <span class="ruby-identifier">term</span>   = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">indent</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">quote</span>  = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">char_pos</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">byte_pos</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">heredoc_indent_mods</span> = <span class="ruby-string">&quot;-&quot;</span>
  <span class="ruby-identifier">heredoc_indent_mods</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39;\~&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby23plus?</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/([#{heredoc_indent_mods}]?)([\&#39;\&quot;\`])(.*?)\2/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">mods</span>, <span class="ruby-identifier">quote</span>, <span class="ruby-identifier">term</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">match</span>[<span class="ruby-value">2</span>], <span class="ruby-identifier">match</span>[<span class="ruby-value">3</span>]
    <span class="ruby-identifier">char_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">charpos</span>
    <span class="ruby-identifier">byte_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span>

    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mods</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_DEDENT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mods</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;~&quot;</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-keyword">case</span> <span class="ruby-identifier">quote</span>
            <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;\&#39;&quot;</span> <span class="ruby-keyword">then</span>
              <span class="ruby-constant">STR_SQUOTE</span>
            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;&quot;&#39;</span> <span class="ruby-keyword">then</span>
              <span class="ruby-constant">STR_DQUOTE</span>
            <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;`&quot;</span> <span class="ruby-keyword">then</span>
              <span class="ruby-identifier">token</span> = <span class="ruby-value">:tXSTRING_BEG</span>
              <span class="ruby-constant">STR_XQUOTE</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">debug</span> <span class="ruby-value">1</span>
            <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[#{heredoc_indent_mods}]?([\&#39;\&quot;\`])(?!\1*\Z)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated here document identifier&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/([#{heredoc_indent_mods}]?)(#{IDENT_CHAR}+)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">mods</span>, <span class="ruby-identifier">term</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">match</span>[<span class="ruby-value">2</span>]
    <span class="ruby-identifier">quote</span> = <span class="ruby-string">&#39;&quot;&#39;</span>
    <span class="ruby-identifier">char_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">charpos</span>
    <span class="ruby-identifier">byte_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span>

    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mods</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_DEDENT</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mods</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;~&quot;</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_DQUOTE</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">old_lineno</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">rest_of_line</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*(?:\r?\n|\z)/</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">rest_of_line</span>.<span class="ruby-identifier">count</span> <span class="ruby-string">&quot;\n&quot;</span>

  <span class="ruby-identifier">char_pos_end</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">charpos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">range</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">range</span> = <span class="ruby-identifier">char_pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">char_pos_end</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">rest_of_line</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-value">:heredoc</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">indent</span>, <span class="ruby-identifier">old_lineno</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">byte_pos</span>]

  <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">quote</span>, <span class="ruby-identifier">old_lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-heredoc_restore" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">heredoc_restore</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="heredoc_restore-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">heredoc_restore</span>                           <span class="ruby-comment"># ../compare/parse30.y:7438</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_term</span>, <span class="ruby-identifier">_func</span>, <span class="ruby-identifier">_indent</span>, <span class="ruby-identifier">lineno</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">bytepos</span> = <span class="ruby-identifier">lex_strterm</span>

  <span class="ruby-identifier">new_ss</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ss_string</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">range</span>.<span class="ruby-identifier">max</span>]
  <span class="ruby-identifier">new_ss</span>.<span class="ruby-identifier">pos</span> = <span class="ruby-identifier">bytepos</span>

  <span class="ruby-identifier">lineno_push</span> <span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">ss_push</span> <span class="ruby-identifier">new_ss</span>

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ignore_body_comments" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ignore_body_comments</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ignore_body_comments-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ignore_body_comments</span>
  <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-in_fname-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">in_fname?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="in_fname-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">in_fname?</span> <span class="ruby-comment"># REFACTOR</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-int_with_base" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">int_with_base</span><span
            class="method-args">(base)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="int_with_base-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">int_with_base</span> <span class="ruby-identifier">base</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">matched</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/__/</span>

  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;ri&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tIMAGINARY</span>, <span class="ruby-constant">Complex</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>)))
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;r&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tRATIONAL</span>, <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>))
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;i&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tIMAGINARY</span>, <span class="ruby-constant">Complex</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tINTEGER</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_after_operator-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_after_operator?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_after_operator-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_after_operator?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_DOT</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_arg-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_arg?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_arg-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_arg?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_ARG_ANY</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_beg-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_beg?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_beg-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 193</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_beg?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_BEG_ANY</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-constant">EXPR_LAB</span> <span class="ruby-comment"># yes, == EXPR_LAB</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_end-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_end?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_end-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_end?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_END_ANY</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_label_possible-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_label_possible?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_label_possible-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_label_possible?</span>
  (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_LABEL</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_ENDFN</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cmd_state</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">is_arg?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_label_suffix-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_label_suffix?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_label_suffix-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_label_suffix?</span>
  <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/:(?!:)/</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_local_id" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_local_id</span><span
            class="method-args">(id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_local_id-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_local_id</span> <span class="ruby-identifier">id</span>
  <span class="ruby-comment"># maybe just make this false for now</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:lvar</span> <span class="ruby-comment"># HACK: this isn&#39;t remotely right</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-is_space_arg-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">is_space_arg?</span><span
            class="method-args">(c = &quot;x&quot;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="is_space_arg-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 209</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">is_space_arg?</span> <span class="ruby-identifier">c</span> = <span class="ruby-string">&quot;x&quot;</span>
  <span class="ruby-identifier">is_arg?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\s/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-lambda_beginning-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">lambda_beginning?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="lambda_beginning-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lambda_beginning?</span>
  <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">paren_nest</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-lex_strterm-3D" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">lex_strterm=</span><span
            class="method-args">(o)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="lex_strterm-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 1117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lex_strterm=</span> <span class="ruby-identifier">o</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_lex_strterm</span>= <span class="ruby-identifier">o</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-identifier">caller</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>).<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)
  <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">d</span> <span class="ruby-value">:lex_strterm</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">o</span>, <span class="ruby-identifier">where</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-lineno-3D" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">lineno=</span><span
            class="method-args">(n)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The current line number.</p>

          <div class="method-source-code" id="lineno-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 1137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lineno=</span> <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_lineno</span>= <span class="ruby-identifier">n</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-identifier">caller</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>).<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)
  <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">d</span> <span class="ruby-value">:lineno</span> <span class="ruby-operator">=&gt;</span> [<span class="ruby-identifier">n</span>, <span class="ruby-identifier">where</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>

        <div class="aliases">
          Also aliased as: <a href="RubyLexer.html#method-i-old_lineno-3D">old_lineno=</a>
        </div>

      </div>

      <div id="method-i-location" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">location</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The current location in the parse.</p>

          <div class="method-source-code" id="location-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">location</span>
  [
    (<span class="ruby-identifier">filename</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&lt;input&gt;&quot;</span>),
    <span class="ruby-identifier">lineno</span>,
    <span class="ruby-identifier">column</span>,
  ].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-lvar_defined-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">lvar_defined?</span><span
            class="method-args">(id)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="lvar_defined-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lvar_defined?</span> <span class="ruby-identifier">id</span>
  <span class="ruby-comment"># TODO: (dyna_in_block? &amp;&amp; dvar_defined?(id)) || local_id?(id)</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:lvar</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-matches" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">matches</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The match groups for the current scan.</p>

          <div class="method-source-code" id="matches-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">matches</span>
  <span class="ruby-identifier">m</span> = (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">9</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ss</span>[<span class="ruby-identifier">i</span>] }
  <span class="ruby-identifier">m</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword">until</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">-1</span>] <span class="ruby-keyword">or</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-newtok" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">newtok</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="newtok-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">newtok</span>
  <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-next_token" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">next_token</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Lex the next token.</p>

          <div class="method-source-code" id="next_token-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">next_token</span>
  <span class="ruby-identifier">maybe_pop_stack</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_string_or_heredoc</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_strterm</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmd_state</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span>    = <span class="ruby-keyword">false</span> <span class="ruby-comment"># TODO: rename token_seen?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_state</span>    = <span class="ruby-identifier">lex_state</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">until</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">token</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\n/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-comment"># line starts 1 position after the newline</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">start_of_current_line_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_pos</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span>
    <span class="ruby-identifier">token</span> =
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">state</span>
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">case</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/[\ \t\r\f\v]+/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span>; <span class="ruby-keyword">next</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\n|\#/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_newline_or_comment</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\]\)\}]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_brace_close</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\!/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\!\@/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_ARG</span>,   <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\![=~]?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\!/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\./</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\.\.\.?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_dots</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\.\d/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;no .&lt;digit&gt; floating literal anymore put 0 before dot&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\./</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_BEG</span>; <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_DOT</span>, <span class="ruby-value">:tDOT</span>, <span class="ruby-string">&quot;.&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\./</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\(/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_paren</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\,/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_PAR</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/=/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=\=\=|\=\=|\=~|\=&gt;|\=(?!begin\b)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-identifier">arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">bol?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=begin(?=\s)/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_begin</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=(?=begin\b)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-identifier">arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /=/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ruby22_label?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;#{SIMPLE_STRING}\&quot;:/o</span>)) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_label</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;(#{SIMPLE_STRING})\&quot;/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_simple_string</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_DQUOTE</span>, <span class="ruby-string">&#39;&quot;&#39;</span>; <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_BEG</span>, <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\@\@?\d/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;`#{text}` is not allowed as a variable name&quot;</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\@\@?#{IDENT_CHAR}+/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_ivar</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/:/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/:([a-zA-Z_]#{IDENT_CHAR}*(?:[?]|[!](?!=)|=(?==&gt;)|=(?![=&gt;]))?)/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:\&quot;(#{SIMPLE_STRING})\&quot;/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:\&#39;(#{SSTRING})\&#39;/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:\:/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_colon2</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_colon1</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /:/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/-&gt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_ENDFN</span>, <span class="ruby-value">:tLAMBDA</span>, <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[+-]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_plus_minus</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/[+\d]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{NUM_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span>  }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_DEC}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">10</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_HEX}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">16</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_BIN}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">2</span>                            }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_OCT_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Illegal octal digit.&quot;</span>    }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_OCT}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">8</span>                            }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{FLOAT_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Trailing &#39;_&#39; in number.&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#{FLOAT}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_float</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/#{INT_DEC2}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">10</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/[0-9]/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Bad number format&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /[+\d]/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\[/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_square_bracket</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">was_label?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&#39;#{SSTRING}\&#39;:?/o</span>)) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_label_or_string</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&#39;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_SQUOTE</span>, <span class="ruby-string">&quot;&#39;&quot;</span>; <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_BEG</span>, <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\|/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\|\|\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;||&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\|\|/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOROP</span>,    <span class="ruby-string">&quot;||&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\|\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;|&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\|/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">state</span> = <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_ARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_PAR</span>; <span class="ruby-identifier">result</span> <span class="ruby-identifier">state</span>, <span class="ruby-value">:tPIPE</span>, <span class="ruby-string">&quot;|&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\|/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\{/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_brace_open</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\*/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\*\*=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;**&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\*\*/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">space_vs_beginning</span>(<span class="ruby-value">:tDSTAR</span>, <span class="ruby-value">:tDSTAR</span>, <span class="ruby-value">:tPOW</span>), <span class="ruby-string">&quot;**&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\*\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;*&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\*/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">space_vs_beginning</span>(<span class="ruby-value">:tSTAR</span>, <span class="ruby-value">:tSTAR</span>, <span class="ruby-value">:tSTAR2</span>), <span class="ruby-string">&quot;*&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\*/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/&lt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&lt;\=\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tCMP</span>, <span class="ruby-string">&quot;&lt;=&gt;&quot;</span>    }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&lt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tLEQ</span>, <span class="ruby-string">&quot;&lt;=&quot;</span>     }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&lt;\&lt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>,  <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&lt;&lt;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;\&lt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_lchevron</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&lt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tLT</span>, <span class="ruby-string">&quot;&lt;&quot;</span>       }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&lt;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/&gt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&gt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tGEQ</span>, <span class="ruby-string">&quot;&gt;=&quot;</span>     }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&gt;\&gt;=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>,  <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&gt;&gt;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&gt;\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tRSHFT</span>, <span class="ruby-string">&quot;&gt;&gt;&quot;</span>   }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tGT</span>, <span class="ruby-string">&quot;&gt;&quot;</span>       }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&gt;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\`/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">expr_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\`/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tBACK_REF2</span>, <span class="ruby-string">&quot;`&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">expr_dot?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\`/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>((<span class="ruby-identifier">cmd_state</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_CMDARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_ARG</span>), <span class="ruby-value">:tBACK_REF2</span>, <span class="ruby-string">&quot;`&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\`/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_XQUOTE</span>, <span class="ruby-string">&#39;`&#39;</span>; <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tXSTRING_BEG</span>, <span class="ruby-string">&quot;`&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\`/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\?/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_questionmark</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/&amp;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&amp;\&amp;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&amp;&amp;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&amp;\&amp;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tANDOP</span>,   <span class="ruby-string">&quot;&amp;&amp;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&amp;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&amp;&quot;</span>  }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\&amp;\./</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_DOT</span>, <span class="ruby-value">:tLONELY</span>,  <span class="ruby-string">&quot;&amp;.&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&amp;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_amper</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&amp;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\//</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_slash</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\^/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\^=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;^&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\^/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tCARET</span>, <span class="ruby-string">&quot;^&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\^/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>; <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tSEMI</span>, <span class="ruby-string">&quot;;&quot;</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/~/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\~@/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tTILDE</span>, <span class="ruby-string">&quot;~&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\~/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tTILDE</span>, <span class="ruby-string">&quot;~&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /~/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\\\r?\n/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span>; <span class="ruby-keyword">next</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;bare backslash only allowed before newline&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\\/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\%/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_percent</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-regexp">/\$/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$_\w+/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$_/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$[~*$?!@\/\\;,.=:&lt;&gt;\&quot;]|\$-\w?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([\&amp;\`\&#39;\+])/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([\&amp;\`\&#39;\+])/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_backref</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([1-9]\d*)/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([1-9]\d*)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_nthref</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$0/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$#{IDENT_CHAR}+/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$\W/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar_oddity</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\$/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\_/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_underscore</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#{IDENT_CHAR}+/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_token</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">skip</span>(<span class="ruby-regexp">/\004|\032|\000|\Z/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { [<span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>, <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>] }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/./</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;Invalid char #{text.inspect} in expression&quot;</span> }
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">string</span>[<span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">..</span> <span class="ruby-value">-1</span>]
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ScanError</span>, <span class="ruby-node">&quot;can not match (#{state.inspect}) at #{location}: &#39;#{text}&#39;&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ScanError</span>, <span class="ruby-node">&quot;undefined state at #{location}: &#39;#{state}&#39;&quot;</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment"># token = case state</span>

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">token</span> <span class="ruby-comment"># allow functions to trigger redo w/ nil</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment"># while</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">LexerError</span>, <span class="ruby-node">&quot;bad lexical result at #{location}: #{token.inspect}&quot;</span> <span class="ruby-keyword">unless</span>
    <span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>)

  <span class="ruby-comment"># auto-switch state</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">token</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-value">:state</span>

  <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-nextc" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">nextc</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="nextc-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">nextc</span>
  <span class="ruby-comment"># TODO:</span>
  <span class="ruby-comment"># if (UNLIKELY((p-&gt;lex.pcur == p-&gt;lex.pend) || p-&gt;eofp || RTEST(p-&gt;lex.nextline))) {</span>
  <span class="ruby-comment">#     if (nextline(p)) return -1;</span>
  <span class="ruby-comment"># }</span>

  <span class="ruby-identifier">maybe_pop_stack</span>

  <span class="ruby-identifier">c</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">getch</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">unscan</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-not_end-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">not_end?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="not_end-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 227</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">not_end?</span>
  <span class="ruby-keyword">not</span> <span class="ruby-identifier">is_end?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-old_lineno-3D" class="method-detail method-alias">
        <div class="method-heading">
          <span class="method-name">old_lineno=</span><span
            class="method-args">(n)</span>
        </div>

        <div class="method-description">
          

        </div>


        <div class="aliases">
          Alias for: <a href="RubyLexer.html#method-i-lineno-3D">lineno=</a>
        </div>
      </div>

      <div id="method-i-parse" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parse</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Parse the given string.</p>

          <div class="method-source-code" id="parse-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ss</span>     = <span class="ruby-identifier">scanner_class</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-value">1</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">start_of_current_line_pos</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">state</span>  <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">do_parse</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-parse_file" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parse_file</span><span
            class="method-args">(path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>Read in and parse the file at <code>path</code>.</p>

          <div class="method-source-code" id="parse_file-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_file</span> <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">parse</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-parse_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">parse_string</span><span
            class="method-args">(quote)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="parse_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">parse_string</span> <span class="ruby-identifier">quote</span>                         <span class="ruby-comment"># ../compare/parse30.y:7273</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span> = <span class="ruby-identifier">quote</span>

  <span class="ruby-identifier">qwords</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>
  <span class="ruby-identifier">regexp</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>
  <span class="ruby-identifier">expand</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>
  <span class="ruby-identifier">list</span>   = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_LIST</span>
  <span class="ruby-identifier">termx</span>  = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_TERM</span> <span class="ruby-comment"># TODO: document wtf this means</span>

  <span class="ruby-identifier">space</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">term_re</span> = <span class="ruby-identifier">regexp_cache</span>[<span class="ruby-identifier">term</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">termx</span> <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># self.nextc if qwords # delayed term</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = <span class="ruby-keyword">nil</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-identifier">regexp</span> <span class="ruby-operator">?</span> <span class="ruby-value">:tREGEXP_END</span> <span class="ruby-operator">:</span> <span class="ruby-value">:tSTRING_END</span>, <span class="ruby-identifier">term</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">space</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">eat_whitespace</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">list</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-value">4</span>
    <span class="ruby-comment"># quote[1] -= STR_FUNC_LIST</span>
    <span class="ruby-comment"># space = true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO: move to quote.nest!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">string_nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">quote</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_TERM</span>

      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSPACE</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">string_term</span> <span class="ruby-identifier">func</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSPACE</span>, <span class="ruby-string">&quot; &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">space</span>

  <span class="ruby-identifier">newtok</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/#/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">t</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">scan_variable_name</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">t</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>

    <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;#&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO: add string_nest, enc, base_enc ?</span>
  <span class="ruby-identifier">lineno</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tokadd_string</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated list meets end of file&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">regexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated regexp meets end of file&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated string meets end of file&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>, <span class="ruby-identifier">lineno</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-possibly_escape_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">possibly_escape_string</span><span
            class="method-args">(text, check)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="possibly_escape_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 231</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">possibly_escape_string</span> <span class="ruby-identifier">text</span>, <span class="ruby-identifier">check</span>
  <span class="ruby-identifier">content</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">check</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESC</span>) { <span class="ruby-identifier">unescape</span> <span class="ruby-node">$1</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">content</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\\\/</span>, <span class="ruby-string">&quot;\\&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\\&#39;/</span>, <span class="ruby-string">&quot;&#39;&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_amper" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_amper</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_amper-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_amper</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;`&amp;&#39; interpreted as argument prefix&quot;</span>)
             <span class="ruby-value">:tAMPER</span>
           <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_BEG</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_MID</span> <span class="ruby-keyword">then</span>
             <span class="ruby-value">:tAMPER</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-value">:tAMPER2</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">token</span>, <span class="ruby-string">&quot;&amp;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_backref" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_backref</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_backref-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 254</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_backref</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span>
  <span class="ruby-comment"># TODO: can&#39;t do lineno hack w/ symbol</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tBACK_REF</span>, <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_begin" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_begin</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_begin-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_begin</span> <span class="ruby-identifier">text</span>
  <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*?\n=end( |\t|\f)*[^\n]*(\n|\z)/m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
    <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;embedded document meets end of file&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-comment"># HACK?</span>

  <span class="ruby-keyword">nil</span> <span class="ruby-comment"># TODO</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_brace_close" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_brace_close</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_brace_close-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 274</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_brace_close</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;}&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DEND</span>, <span class="ruby-identifier">matched</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">brace_nest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># matching compare/parse26.y:8099</span>
  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">pop</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">pop</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;}&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-identifier">ruby24minus?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_ENDARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_END</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRCURLY</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;]&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-identifier">ruby24minus?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_ENDARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_END</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRBRACK</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;)&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-constant">EXPR_ENDFN</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRPAREN</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown bracing: #{matched.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_brace_open" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_brace_open</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_brace_open-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_brace_open</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># matching compare/parse23.y:8694</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lambda_beginning?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># close arg list when lambda opens body</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">expr_result</span>(<span class="ruby-value">:tLAMBEG</span>, <span class="ruby-string">&quot;{&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_LABELED</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:tLBRACE</span>     <span class="ruby-comment"># hash</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_ARG_ANY</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_END</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_ENDFN</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:tLCURLY</span>     <span class="ruby-comment"># block (primary) &quot;{&quot; in parse.y</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_ENDARG</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:tLBRACE_ARG</span> <span class="ruby-comment"># block (expr)</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-value">:tLBRACE</span>     <span class="ruby-comment"># hash</span>
          <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">token</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tLBRACE_ARG</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_BEG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_PAR</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:tLBRACE</span>

  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span> <span class="ruby-identifier">state</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_colon1" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_colon1</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_colon1-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_colon1</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># ?: / then / when</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_end?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tCOLON</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&#39;/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_SSYM</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_DSYM</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_FNAME</span>, <span class="ruby-value">:tSYMBEG</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_colon2" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_colon2</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_colon2-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 348</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_colon2</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_CLASS</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tCOLON3</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_DOT</span>, <span class="ruby-value">:tCOLON2</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_dots" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_dots</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_dots-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 356</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_dots</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">tokens</span> = <span class="ruby-identifier">ruby27plus?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-operator">?</span> <span class="ruby-constant">BTOKENS</span> <span class="ruby-operator">:</span> <span class="ruby-constant">TOKENS</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-identifier">tokens</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_float" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_float</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_float-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_float</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/__/</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;ri&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tIMAGINARY</span>, <span class="ruby-constant">Complex</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">chop</span>))
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;i&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tIMAGINARY</span>, <span class="ruby-constant">Complex</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>.<span class="ruby-identifier">to_f</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">end_with?</span>(<span class="ruby-string">&quot;r&quot;</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tRATIONAL</span>,  <span class="ruby-constant">Rational</span>(<span class="ruby-identifier">text</span>.<span class="ruby-identifier">chop</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_NUM</span>, <span class="ruby-value">:tFLOAT</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_f</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_gvar" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_gvar</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_gvar-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 377</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_gvar</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;$-&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unexpected $undefined&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tGVAR</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_gvar_oddity" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_gvar_oddity</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_gvar_oddity-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_gvar_oddity</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;#{text.inspect} is not allowed as a global variable name&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_ivar" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_ivar</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_ivar-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 389</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_ivar</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">tok_id</span> = <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^@@/</span> <span class="ruby-operator">?</span> <span class="ruby-value">:tCVAR</span> <span class="ruby-operator">:</span> <span class="ruby-value">:tIVAR</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-identifier">tok_id</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_label" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_label</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_label-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 394</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_label</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">symbol</span> = <span class="ruby-identifier">possibly_escape_string</span> <span class="ruby-identifier">text</span>, <span class="ruby-regexp">/^\&quot;/</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_LAB</span>, <span class="ruby-value">:tLABEL</span>, <span class="ruby-identifier">symbol</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_label_or_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_label_or_string</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_label_or_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 400</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_label_or_string</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@was_label</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/:\Z/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@was_label</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_label</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/:\Z/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># put back &quot;:&quot;</span>
    <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">orig_line</span> = <span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\\\/</span>, <span class="ruby-string">&quot;\\&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\\&#39;/</span>, <span class="ruby-string">&quot;\&#39;&quot;</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">str</span>, <span class="ruby-identifier">orig_line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_lchevron" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_lchevron</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_lchevron-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 416</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_lchevron</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">EXPR_DOT</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_CLASS</span> <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-operator">!</span><span class="ruby-identifier">is_end?</span> <span class="ruby-operator">&amp;&amp;</span>
      (<span class="ruby-operator">!</span><span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_LABELED</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">space_seen</span>)) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">tok</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">heredoc_identifier</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">tok</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tok</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_ARG</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_CLASS</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_BEG</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-value">:tLSHFT</span>, <span class="ruby-string">&quot;\&lt;\&lt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_newline_or_comment" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_newline_or_comment</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_newline_or_comment-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_newline_or_comment</span> <span class="ruby-identifier">text</span>    <span class="ruby-comment"># ../compare/parse30.y:9126 ish</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-identifier">matched</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;#&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>

    <span class="ruby-keyword">while</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s*\#.*(\n+|\z)/</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">count</span> <span class="ruby-string">&quot;\n&quot;</span>
      <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/^ +#/</span>, <span class="ruby-string">&quot;#&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/^ +$/</span>, <span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">c</span> = (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_BEG</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_CLASS</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_FNAME</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_DOT</span> <span class="ruby-operator">&amp;&amp;</span>
       <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">EXPR_LABELED</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">||</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-constant">EXPR_LAB</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># yes, == EXPR_LAB</span>
    <span class="ruby-comment"># ignore if !fallthrough?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">in_kwarg</span> <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># normal newline</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tNL</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">maybe_pop_stack</span>
      <span class="ruby-keyword">return</span> <span class="ruby-comment"># goto retry</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\ \t\r\f\v]+/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/#/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-comment"># goto retry</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/&amp;\.|\.(?!\.)/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># C version is a hellish obfuscated xnor</span>
    <span class="ruby-keyword">return</span> <span class="ruby-comment"># goto retry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tNL</span>, <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_nthref" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_nthref</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_nthref-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 477</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_nthref</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># TODO: can&#39;t do lineno hack w/ number</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tNTH_REF</span>, <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_paren" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_paren</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_paren-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_paren</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:tLPAREN</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">then</span>
            <span class="ruby-comment"># foo( ... ) =&gt; method call, no ambiguity</span>
            <span class="ruby-value">:tLPAREN2</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:tLPAREN_ARG</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_ENDFN</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">lambda_beginning?</span> <span class="ruby-keyword">then</span>
            <span class="ruby-comment"># TODO:</span>
            <span class="ruby-comment"># warn(&quot;parentheses after method name is interpreted as &quot; \</span>
            <span class="ruby-comment">#      &quot;an argument list, not a decomposed argument&quot;)</span>
            <span class="ruby-value">:tLPAREN2</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-value">:tLPAREN2</span> <span class="ruby-comment"># plain &quot;(&quot; in parse.y</span>
          <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_PAR</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_percent" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_percent</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_percent-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 506</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_percent</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">process_percent_quote</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>)
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;%&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">is_space_arg?</span>(<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>)) <span class="ruby-operator">||</span> (<span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FITEM</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/s/</span>))
    <span class="ruby-identifier">process_percent_quote</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tPERCENT</span>, <span class="ruby-string">&quot;%&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_percent_quote" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_percent_quote</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>called from <a href="RubyLexer.html#method-i-process_percent"><code>process_percent</code></a></p>

          <div class="method-source-code" id="process_percent_quote-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 260</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_percent_quote</span>                      <span class="ruby-comment"># ../compare/parse30.y:8645</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-identifier">getch</span> <span class="ruby-comment"># type %&lt;type&gt;&lt;term&gt;...&lt;term&gt;</span>

  <span class="ruby-identifier">long_hand</span> = <span class="ruby-operator">!</span><span class="ruby-operator">!</span>(<span class="ruby-identifier">c</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[QqWwIixrs]/</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\p{Alnum}/</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">term</span> = <span class="ruby-identifier">c</span> <span class="ruby-comment"># TODO? PERCENT_END[c] || c</span>

    <span class="ruby-identifier">debug</span> <span class="ruby-value">2</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\p{ASCII}/</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-string">&quot;Q&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">term</span> = <span class="ruby-identifier">getch</span>

    <span class="ruby-identifier">debug</span> <span class="ruby-value">3</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\p{Alnum}|\P{ASCII}/</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated quoted string meets end of file&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># &quot;\0&quot; is special to indicate beg=nnd and that no nesting?</span>
  <span class="ruby-identifier">paren</span> = <span class="ruby-identifier">term</span>
  <span class="ruby-identifier">term</span> = <span class="ruby-constant">PERCENT_END</span>[<span class="ruby-identifier">term</span>]
  <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span> = <span class="ruby-identifier">paren</span>, <span class="ruby-string">&quot;\0&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-comment"># TODO: &quot;\0&quot; -&gt; nil</span>

  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">long_hand</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;%#{c}#{paren}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;%#{term}&quot;</span>

  <span class="ruby-identifier">current_line</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>

  <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">string_type</span> =
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">c</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;Q&quot;</span> <span class="ruby-keyword">then</span>
      [<span class="ruby-value">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_DQUOTE</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;q&quot;</span> <span class="ruby-keyword">then</span>
      [<span class="ruby-value">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;W&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">eat_whitespace</span>
      [<span class="ruby-value">:tWORDS_BEG</span>,    <span class="ruby-constant">STR_DQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;w&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">eat_whitespace</span>
      [<span class="ruby-value">:tQWORDS_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;I&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">eat_whitespace</span>
      [<span class="ruby-value">:tSYMBOLS_BEG</span>,  <span class="ruby-constant">STR_DQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;i&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">eat_whitespace</span>
      [<span class="ruby-value">:tQSYMBOLS_BEG</span>, <span class="ruby-constant">STR_SQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;x&quot;</span> <span class="ruby-keyword">then</span>
      [<span class="ruby-value">:tXSTRING_BEG</span>,  <span class="ruby-constant">STR_XQUOTE</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;r&quot;</span> <span class="ruby-keyword">then</span>
      [<span class="ruby-value">:tREGEXP_BEG</span>,   <span class="ruby-constant">STR_REGEXP</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;s&quot;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_FNAME</span>
      [<span class="ruby-value">:tSYMBEG</span>,       <span class="ruby-constant">STR_SSYM</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;unknown type of %string. Expected [QqWwIixrs], found &#39;#{c}&#39;.&quot;</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">string</span> <span class="ruby-identifier">string_type</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>

  <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">text</span>, <span class="ruby-identifier">current_line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_plus_minus" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_plus_minus</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_plus_minus-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 519</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_plus_minus</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">sign</span> = <span class="ruby-identifier">matched</span>
  <span class="ruby-identifier">utype</span>, <span class="ruby-identifier">type</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">sign</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;+&quot;</span> <span class="ruby-keyword">then</span>
                  [<span class="ruby-value">:tUPLUS</span>, <span class="ruby-value">:tPLUS</span>]
                <span class="ruby-keyword">else</span>
                  [<span class="ruby-value">:tUMINUS</span>, <span class="ruby-value">:tMINUS</span>]
                <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/@/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-constant">EXPR_ARG</span>, <span class="ruby-identifier">utype</span>, <span class="ruby-node">&quot;#{sign}@&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-constant">EXPR_ARG</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">sign</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-identifier">sign</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>)) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">arg_ambiguous</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\d/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">utype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tUPLUS</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tUMINUS_NUM</span>, <span class="ruby-identifier">sign</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-identifier">utype</span>, <span class="ruby-identifier">sign</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">sign</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_questionmark" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_questionmark</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_questionmark-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 551</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_questionmark</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_end?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;incomplete character syntax: parsed #{text.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s|\v/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">c2</span> = { <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;s&quot;</span>,
            <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;n&quot;</span>,
            <span class="ruby-string">&quot;\t&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;t&quot;</span>,
            <span class="ruby-string">&quot;\v&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;v&quot;</span>,
            <span class="ruby-string">&quot;\r&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;r&quot;</span>,
            <span class="ruby-string">&quot;\f&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;f&quot;</span> }[<span class="ruby-identifier">matched</span>]

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c2</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;invalid character syntax; use ?\\&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c2</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># ternary</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\w(?=\w)/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># ternary, also</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">c</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_escape</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">getch</span>
      <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_simple_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_simple_string</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_simple_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 589</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_simple_string</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">orig_line</span> = <span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>]
    .<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESC</span>) { <span class="ruby-identifier">unescape</span>(<span class="ruby-node">$1</span>).<span class="ruby-identifier">b</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span> }
  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">b</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">str</span>, <span class="ruby-identifier">orig_line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_slash" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_slash</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_slash-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_slash</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_REGEXP</span>, <span class="ruby-identifier">matched</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tREGEXP_BEG</span>, <span class="ruby-string">&quot;/&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-constant">EXPR_BEG</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;/&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">arg_ambiguous</span>
      <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_REGEXP</span>, <span class="ruby-string">&quot;/&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:tREGEXP_BEG</span>, <span class="ruby-string">&quot;/&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tDIVIDE</span>, <span class="ruby-string">&quot;/&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_square_bracket" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_square_bracket</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_square_bracket-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 622</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_square_bracket</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_after_operator?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\]\=/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># HACK? I dunno, or bug in MRI</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_ARG</span>, <span class="ruby-value">:tASET</span>, <span class="ruby-string">&quot;[]=&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># HACK? I dunno, or bug in MRI</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_ARG</span>, <span class="ruby-value">:tAREF</span>, <span class="ruby-string">&quot;[]&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unexpected &#39;[&#39;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">space_seen</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_LABELED</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK2</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_PAR</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_string_or_heredoc" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_string_or_heredoc</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_string_or_heredoc-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_string_or_heredoc</span>                  <span class="ruby-comment"># ../compare/parse30.y:9075</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_strterm</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:heredoc</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">heredoc</span> <span class="ruby-identifier">lex_strterm</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse_string</span> <span class="ruby-identifier">lex_strterm</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_symbol" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_symbol</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_symbol-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 651</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_symbol</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">symbol</span> = <span class="ruby-identifier">possibly_escape_string</span> <span class="ruby-identifier">text</span>, <span class="ruby-regexp">/^:\&quot;/</span> <span class="ruby-comment"># stupid emacs</span>

  <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_LIT</span>, <span class="ruby-value">:tSYMBOL</span>, <span class="ruby-identifier">symbol</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_token" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_token</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_token-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 657</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_token</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># matching: parse_ident in compare/parse23.y:7989</span>
  <span class="ruby-comment"># FIX: remove: self.last_state = lex_state</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\!\?](?!=)/</span>)

  <span class="ruby-identifier">tok_id</span> =
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[!?]$/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-value">:tFID</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/=(?:(?![~&gt;=])|(?==&gt;))/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># ident=, not =~ =&gt; == or followed by =&gt;</span>
      <span class="ruby-comment"># TODO test lexing of a=&gt;b vs a==&gt;b</span>
      <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
      <span class="ruby-value">:tIDENTIFIER</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^[A-Z]/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-value">:tCONSTANT</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-value">:tIDENTIFIER</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_label_possible?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">is_label_suffix?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/:/</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_LAB</span>, <span class="ruby-value">:tLABEL</span>, <span class="ruby-identifier">token</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># TODO: mb == ENC_CODERANGE_7BIT &amp;&amp; lex_state !~ EXPR_DOT</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">EXPR_DOT</span> <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># See if it is a reserved word.</span>
    <span class="ruby-identifier">keyword</span> = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyword</span>.<span class="ruby-identifier">keyword</span> <span class="ruby-identifier">token</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_token_keyword</span> <span class="ruby-identifier">keyword</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">keyword</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># matching: compare/parse30.y:9039</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_BEG_ANY</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_ARG_ANY</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_DOT</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">cmd_state</span> <span class="ruby-operator">?</span> <span class="ruby-constant">EXPR_CMDARG</span> <span class="ruby-operator">:</span> <span class="ruby-constant">EXPR_ARG</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span> <span class="ruby-keyword">then</span>
            <span class="ruby-constant">EXPR_ENDFN</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-constant">EXPR_END</span>
          <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">state</span>

  <span class="ruby-identifier">tok_id</span> = <span class="ruby-value">:tIDENTIFIER</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tok_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tCONSTANT</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_local_id</span>(<span class="ruby-identifier">token</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_state</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">EXPR_DOT</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_FNAME</span> <span class="ruby-keyword">and</span>
      (<span class="ruby-identifier">tok_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tIDENTIFIER</span>) <span class="ruby-keyword">and</span> <span class="ruby-comment"># not EXPR_FNAME, not attrasgn</span>
      <span class="ruby-identifier">lvar_defined?</span>(<span class="ruby-identifier">token</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-constant">EXPR_END</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_LABEL</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-identifier">state</span>, <span class="ruby-identifier">tok_id</span>, <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_token_keyword" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_token_keyword</span><span
            class="method-args">(keyword)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_token_keyword-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 713</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_token_keyword</span> <span class="ruby-identifier">keyword</span>
  <span class="ruby-comment"># matching MIDDLE of parse_ident in compare/parse23.y:8046</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">lex_state</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-constant">EXPR_ENDFN</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span>, <span class="ruby-identifier">token</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_FNAME</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">state</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_BEG</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">==</span> <span class="ruby-value">:kDO</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># parse26.y line 7591</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">lambda_beginning?</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span> = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># lambda_beginning? == FALSE in the body of &quot;-&gt; do ... end&quot;</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># TODO: question this?</span>
      <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-value">:kDO_LAMBDA</span>, <span class="ruby-identifier">token</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">is_in_state</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-value">:kDO_COND</span>, <span class="ruby-identifier">token</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">is_in_state</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">EXPR_CMDARG</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-value">:kDO_BLOCK</span>, <span class="ruby-identifier">token</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-value">:kDO</span>, <span class="ruby-identifier">token</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">EXPR_PAD</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span>, <span class="ruby-identifier">token</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_PAR</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>, <span class="ruby-identifier">token</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-identifier">lex_state</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>, <span class="ruby-identifier">token</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-process_underscore" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">process_underscore</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="process_underscore-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 745</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">process_underscore</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">unscan</span> <span class="ruby-comment"># put back &quot;_&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\__END__(\r?\n|\Z)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">terminate</span>
    [<span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>, <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#{IDENT_CHAR}+/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">process_token</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rb_compile_error" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rb_compile_error</span><span
            class="method-args">(msg)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="rb_compile_error-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 756</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rb_compile_error</span> <span class="ruby-identifier">msg</span>
  <span class="ruby-identifier">msg</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;. near line #{self.lineno}: #{self.rest[/^.*/].inspect}&quot;</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>, <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-read_escape" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">read_escape</span><span
            class="method-args">(flags = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="read_escape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 331</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_escape</span> <span class="ruby-identifier">flags</span> = <span class="ruby-keyword">nil</span>                    <span class="ruby-comment"># ../compare/parse30.y:6712</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>                  <span class="ruby-comment"># Backslash</span>
    <span class="ruby-string">&#39;\\&#39;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/n/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># newline</span>
    <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/t/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># horizontal tab</span>
    <span class="ruby-string">&quot;\t&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/r/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># carriage-return</span>
    <span class="ruby-string">&quot;\r&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/f/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># form-feed</span>
    <span class="ruby-string">&quot;\f&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/v/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># vertical tab</span>
    <span class="ruby-string">&quot;\13&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/a/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># alarm(bell)</span>
    <span class="ruby-string">&quot;\007&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/e/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># escape</span>
    <span class="ruby-string">&quot;\033&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[0-7]{1,3}/</span>) <span class="ruby-keyword">then</span>          <span class="ruby-comment"># octal constant</span>
    (<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xFF</span>).<span class="ruby-identifier">chr</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/x([0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># hex constant</span>
    <span class="ruby-comment"># TODO: force encode everything to UTF-8?</span>
    <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/b/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># backspace</span>
    <span class="ruby-string">&quot;\010&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/s/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># space</span>
    <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/M-\\u/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-value">5</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/M-\\(?=.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">read_escape</span>
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/M-(\p{ASCII})/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># TODO: ISCNTRL(c) -&gt; goto eof</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/(C-|c)\\u/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-value">6</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(C-|c)\\?\?/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-value">127</span>.<span class="ruby-identifier">chr</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(C-|c)\\/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">read_escape</span>
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(?:C-|c)(.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^[89]/i</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># bad octal or hex... MRI ignores them :(</span>
    <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/u(\h{4})/</span>) <span class="ruby-keyword">then</span>
    [<span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/u(\h{1,3})/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">debug</span> <span class="ruby-value">7</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/u\{(\h+(?: +\h+)*)\}/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>) }.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U*&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[McCx0-9]/</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">getch</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-regx_options" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">regx_options</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="regx_options-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 397</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">regx_options</span>                               <span class="ruby-comment"># ../compare/parse30.y:6914</span>
  <span class="ruby-identifier">newtok</span>

  <span class="ruby-identifier">options</span> = <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\p{Alpha}+/</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>

  <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;unknown regexp options: %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">options</span>]) <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">options</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[^ixmonesu]/</span>

  <span class="ruby-identifier">options</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-reset" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">reset</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 761</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>        = <span class="ruby-value">1</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span>    = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>      = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>     = <span class="ruby-constant">EXPR_NONE</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span>   = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span>      = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span>    = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span>    = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span>   = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">token</span>         = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_ss</span>        = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_lineno</span>    = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cond</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby22_label-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby22_label?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby22_label-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 788</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby22_label?</span>
  <span class="ruby-identifier">ruby22plus?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">is_label_possible?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby22plus-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby22plus?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby22plus-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 792</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby22plus?</span>
  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">22</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby23plus-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby23plus?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby23plus-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 796</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby23plus?</span>
  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">23</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby24minus-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby24minus?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby24minus-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 800</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby24minus?</span>
  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">24</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-ruby27plus-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">ruby27plus?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="ruby27plus-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 804</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ruby27plus?</span>
  <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">27</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-scan_variable_name" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">scan_variable_name</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="scan_variable_name-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 408</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scan_variable_name</span>                        <span class="ruby-comment"># ../compare/parse30.y:7208</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#(?=\$(-.|[a-zA-Z_0-9~\*\$\?!@\/\\;,\.=:&lt;&gt;\&quot;\&amp;\`\&#39;+]))/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># TODO: !ISASCII</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#(?=\@\@?[a-zA-Z_])/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># TODO: !ISASCII</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#[{]/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DBEG</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/#/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># do nothing but swallow</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># if scan(/\P{ASCII}|_|\p{Alpha}/) then # TODO: fold into above DVAR cases</span>
  <span class="ruby-comment">#   # if (!ISASCII(c) || c == &#39;_&#39; || ISALPHA(c))</span>
  <span class="ruby-comment">#   #     return tSTRING_DVAR;</span>
  <span class="ruby-comment"># end</span>

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-scanner_class" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">scanner_class</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>The current scanner class. Must be overridden in subclasses.</p>

          <div class="method-source-code" id="scanner_class-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rex.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">scanner_class</span>
  <span class="ruby-constant">StringScanner</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-space_vs_beginning" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">space_vs_beginning</span><span
            class="method-args">(space_type, beg_type, fallback)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="space_vs_beginning-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 808</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">space_vs_beginning</span> <span class="ruby-identifier">space_type</span>, <span class="ruby-identifier">beg_type</span>, <span class="ruby-identifier">fallback</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/./m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">warning</span> <span class="ruby-string">&quot;`**&#39; interpreted as argument prefix&quot;</span>
    <span class="ruby-identifier">space_type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">beg_type</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># TODO: warn_balanced(&quot;**&quot;, &quot;argument prefix&quot;);</span>
    <span class="ruby-identifier">fallback</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">string</span><span
            class="method-args">(type, beg, nnd = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 431</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">string</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">nnd</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-comment"># label = (IS_LABEL_POSSIBLE() ? str_label : 0);</span>
  <span class="ruby-comment"># p-&gt;lex.strterm = NEW_STRTERM(str_dquote | label, &#39;&quot;&#39;, 0);</span>
  <span class="ruby-comment"># p-&gt;lex.ptok = p-&gt;lex.pcur-1;</span>

  <span class="ruby-identifier">type</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_LABEL</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_label_possible?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-value">:strterm</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">nnd</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;\0&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-string_term" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">string_term</span><span
            class="method-args">(func)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="string_term-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">string_term</span> <span class="ruby-identifier">func</span>                          <span class="ruby-comment"># ../compare/parse30.y:7254</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-constant">EXPR_END</span>, <span class="ruby-value">:tREGEXP_END</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">regx_options</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_LABEL</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_label_suffix?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">getch</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_BEG</span><span class="ruby-operator">|</span><span class="ruby-constant">EXPR_LABEL</span>

    <span class="ruby-keyword">return</span> <span class="ruby-value">:tLABEL_END</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span> = <span class="ruby-constant">EXPR_END</span>

  <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_END</span>, [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">matched</span>, <span class="ruby-identifier">func</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tokadd" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tokadd</span><span
            class="method-args">(c)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="tokadd-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 458</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tokadd</span> <span class="ruby-identifier">c</span>                                  <span class="ruby-comment"># ../compare/parse30.y:6548</span>
  <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tokadd_escape" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tokadd_escape</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="tokadd_escape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 462</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tokadd_escape</span>                              <span class="ruby-comment"># ../compare/parse30.y:6840</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\\n/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># just ignore</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\([0-7]{1,3}|x[0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\([MC]-|c)(?=\\)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tokadd_escape</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\([MC]-|c)(.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">matched</span>

    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tokadd_escape</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-comment"># recurse if continued!</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\[McCx]/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># all unprocessed branches from above have failed</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\(.)/m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">chr</span>, = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>]

    <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span>
    <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">chr</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid escape character syntax: %p&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">rest</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">first</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tokadd_string" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tokadd_string</span><span
            class="method-args">(func, term, paren)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="tokadd_string-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 487</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tokadd_string</span> <span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>           <span class="ruby-comment"># ../compare/parse30.y:7020</span>
  <span class="ruby-identifier">qwords</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>
  <span class="ruby-identifier">escape</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_ESCAPE</span>
  <span class="ruby-identifier">expand</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>
  <span class="ruby-identifier">regexp</span> = <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>

  <span class="ruby-identifier">paren_re</span> = <span class="ruby-identifier">regexp_cache</span>[<span class="ruby-identifier">paren</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;\0&quot;</span>
  <span class="ruby-identifier">term_re</span>  = <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;\n&quot;</span>
               <span class="ruby-regexp">/\r?\n/</span>
             <span class="ruby-keyword">else</span>
               <span class="ruby-identifier">regexp_cache</span>[<span class="ruby-identifier">term</span>]
             <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">until</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">paren_re</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">paren_re</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># TODO: ss.unscan 665 errors #$ HACK: why do we depend on this so hard?</span>
        <span class="ruby-keyword">break</span> <span class="ruby-comment"># leave eos loop, go parse term in caller (heredoc or parse_string)</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>)
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/#[\$\@\{]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># do nothing since we used `check`</span>
      <span class="ruby-keyword">break</span> <span class="ruby-comment"># leave eos loop</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\\n/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">case</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\n&quot;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">func</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">STR_FUNC_INDENT</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">unscan</span>     <span class="ruby-comment"># rollback</span>
            <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-comment"># and split</span>
            <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\n/</span>) <span class="ruby-comment"># this is `matched`</span>
            <span class="ruby-keyword">break</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span>
          <span class="ruby-identifier">debug</span> <span class="ruby-value">9</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">unscan</span>     <span class="ruby-comment"># rollback</span>
          <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-comment"># this is `matched`</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\\\\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&#39;\\&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span>
        <span class="ruby-identifier">nextc</span> <span class="ruby-comment"># ignore 1st \\</span>
        <span class="ruby-identifier">nextc</span> <span class="ruby-comment"># for tokadd ss.matched, below</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\u/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">tokadd_utf8</span> <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">regexp</span>

        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-comment"># eat it, we know it&#39;s there</span>

        <span class="ruby-keyword">return</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\P{ASCII}/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">expand</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">matched</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">case</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">regexp</span> <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">SIMPLE_RE_META</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">matched</span>
            <span class="ruby-keyword">next</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># TODO: ss.unscan 15 errors</span>
          <span class="ruby-comment"># HACK? decide whether to eat the \\ above</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">_esc</span> = <span class="ruby-identifier">tokadd_escape</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">debug</span> <span class="ruby-value">10</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-keyword">next</span> <span class="ruby-comment"># C&#39;s continue = Ruby&#39;s next</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">read_escape</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-comment"># ignore backslashed spaces in %w</span>
        <span class="ruby-keyword">when</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">paren_re</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-identifier">paren_re</span>)) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\&quot;</span>
          <span class="ruby-keyword">next</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">getch</span> <span class="ruby-comment"># slurp it too for matched below</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment"># inner case for /\\/</span>

    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\P{ASCII}/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># not currently checking encoding stuff -- drops to tokadd below</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">break</span> <span class="ruby-comment"># leave eos loop</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">t</span>  = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;\r\n&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">term</span>
      <span class="ruby-identifier">x</span>  = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">paren</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;\000&quot;</span>
      <span class="ruby-identifier">q</span>  = <span class="ruby-string">&quot;\\s&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span>
      <span class="ruby-identifier">re</span> = <span class="ruby-regexp">/[^#{t}#{x}\#\\#{q}]+/</span>

      <span class="ruby-identifier">scan</span> <span class="ruby-identifier">re</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">getch</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">count</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment"># big case</span>

    <span class="ruby-identifier">tokadd</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment"># until end_of_stream?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">matched</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tokadd_utf8" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tokadd_utf8</span><span
            class="method-args">(term, func, regexp_literal)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="tokadd_utf8-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer_strings.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tokadd_utf8</span> <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">regexp_literal</span>    <span class="ruby-comment"># ../compare/parse30.y:6646</span>
  <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;\\u&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">regexp_literal</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\h{4}/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">codepoint</span> = [<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)

    <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">regexp_literal</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">matched</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">codepoint</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\{\s*(\h{1,6}(?:\s+\h{1,6})*)\s*\}/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">codepoints</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-value">16</span> }.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">regexp_literal</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;{&quot;</span>
      <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">split</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
      <span class="ruby-identifier">tokadd</span> <span class="ruby-string">&quot;}&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">tokadd</span> <span class="ruby-identifier">codepoints</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated Unicode escape&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-unescape" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">unescape</span><span
            class="method-args">(s)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="unescape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 820</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unescape</span> <span class="ruby-identifier">s</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">ESCAPES</span>[<span class="ruby-identifier">s</span>]

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>

  <span class="ruby-identifier">x</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[0-7]{1,3}/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$&amp;</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xFF</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^x([0-9a-fA-F]{1,2})/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-node">$1</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^M-(.)/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$1</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^(C-|c)(.)/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$2</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[89a-f]/i</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># bad octal or hex... ignore? that&#39;s what MRI does :(</span>
        <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[McCx0-9]/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>)
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/u(\h{4})/</span> <span class="ruby-keyword">then</span>
        [<span class="ruby-node">$1</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;{}&quot;</span>).<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/u(\h{1,3})/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>)
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/u\{(\h+(?:\s+\h+)*)\}/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-node">$1</span>.<span class="ruby-identifier">split</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>) }.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U*&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">x</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-warning" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">warning</span><span
            class="method-args">(s)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="warning-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 850</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">warning</span> <span class="ruby-identifier">s</span>
  <span class="ruby-comment"># do nothing for now</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-was_label-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">was_label?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="was_label-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/3.1.0/gems/ruby_parser-3.18.1/lib/ruby_lexer.rb, line 854</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">was_label?</span>
  <span class="ruby-ivar">@was_label</span> = <span class="ruby-identifier">ruby22_label?</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.4.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

